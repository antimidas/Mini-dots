import{a as I}from"../chunks/chunk-J5F3A7TB.js";import{t as S}from"../chunks/chunk-CHZKSFGE.js";import{c as ee}from"../chunks/chunk-HPNQXUCM.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-BETA3R27.js";import{e as $}from"../chunks/chunk-3GYLW4KZ.js";var c=$(ee());(async function(){let T=0,q=!1,s,i={nonLinkAnchor:{query:"div.prose a.decorated-link[target='_new']",foundLinks:[],tracksText:!0},textLink:{query:"a[class=''][target='_new']",foundLinks:[]},buttonLink:{query:"a.rounded-xl",foundLinks:[]}},w="div[data-radix-popper-content-wrapper]",H="div > div.items-center div.text-token-text-primary span.flex-col a",P="div > div.items-center div.text-token-text-primary span.text-token-text-tertiary",C="div.bg-token-sidebar-surface-primary",a=null,D="div.rounded-md.origin-left.bg-token-border-default",O="div.flex-col.rounded-xl.p-3",A=1e4,u,h=500,v=0,R="div.text-sm.items-center.font-medium div.truncate",B="div.flex-row.items-center span.font-semibold",N=function(){s.isConnected&&z()},F=c.default.debounce(N,500,{maxWait:1e3}),_=new MutationObserver(F),j={attributes:!0,childList:!0,subtree:!0,characterData:!0};function G(e,t){t.disconnect(),t.observe(e,j)}function x(){let e=s.querySelector(H),t=s.querySelector(P);if(!e)return;let o=e.getAttribute("href"),p=t?.innerText;return{popoverLink:o,popoverCount:p}}function d(e){S("track","deweyResult",{pageType:"searchPage",url:window.location.href,pageDataMeta:JSON.stringify({chatGPTMode:!0,...e})},{anonymized:!0,skipAllowlistCheck:!0})}function z(){let e=x();d({eventType:"popoverCycled",linkResult:e})}function J(){let e=x();d({eventType:"popoverOpened",linkResult:e})}function Q(e,t){if(!a)return;let o=[];a.querySelectorAll(O).forEach(m=>{let k={name:m.querySelector(R)?.innerText,price:m.querySelector(B)?.innerText};o.push(k)}),d({eventType:"sidePanel",eventSubType:t,buttonInfo:e,sidePanelOptions:o})}function b(){clearInterval(u),u=0,v=0}let E=(e,t)=>{u&&b(),u=setInterval(()=>{let o=a?.querySelector(D);v+=h,(!o||v>=A)&&(b(),setTimeout(()=>{Q(e,t)},500))},h)};function W(){for(let e in i)i[e].foundLinks=[]}async function K(e){W();let t={},o=!1;for(let n in i){let r=e.querySelectorAll(i[n].query)??[],l=c.default.map(r,y=>y.getAttribute("href"))??[],f=c.default.map(r,y=>y.innerText)??[];i[n].foundLinks=l;let L=await I(l);t[n]={selector:i[n].query,foundLinkCount:i[n].foundLinks.length,relevantLinks:L,relevantLinkCount:L.length};let M=i[n].tracksText&&f.length>0;M&&(t[n].textOfLinks=f),o=M||L.length>0||o}let p=e.querySelectorAll("div.bg-token-bg-primary.border-token-border-default.rounded-xl.bg-clip-padding"),m=e.querySelectorAll("h4 > strong > span.inline.underline.decoration-token-text-secondary"),k="img",X="div.line-clamp-2.text-ellipsis",Y="div.text-md.font-semibold",Z="div.text-token-text-secondary.text-xs",g=[];p.forEach(n=>{let r={img:n.querySelector(k)?.getAttribute("src")??"",header:n.querySelector(X)?.innerText??"",price:n.querySelector(Y)?.innerText??"",footer:n.querySelector(Z)?.innerText??""};g.push(r);let l=c.default.find(m,f=>f?.innerText===r.header);n.addEventListener("click",()=>E(r,"itemButton")),l&&l.addEventListener("click",()=>E(r,"itemTableHeader"))}),t.optionButtons=g,(o||g.length>0)&&d({eventType:"newResponse",...t})}async function U(){let e=window.document.querySelectorAll('div[class*="group-focus-within/turn-messages:[mask-position:0_0]"]');if(e.length>T){T=e.length;let t=window.document.querySelectorAll("article.text-token-text-primary");await K(t[t.length-1])}}async function V(){if(q)return;let e=window.document.querySelectorAll(w);e.length>0&&s!==e[0]&&(s=e[0],G(e[0],_),J())}a=window.document.querySelector(C),setInterval(()=>{U(),V()},500)})();
