import{A as f,g as c,o as d,q as g}from"../../chunks/chunk-UTQLHGJH.js";import"../../chunks/chunk-KUOYBGP4.js";import{a as C}from"../../chunks/chunk-PDIOZR2P.js";import{d as b,e as w}from"../../chunks/chunk-3GYLW4KZ.js";var M=w(C());f();var i={};b(i,{couponsFromOffscreenMessenger:()=>a});f();var u=`${c}?site=PlatformDetectionModule`,s=new Map,l;function R(e,t){document.querySelector(`iframe[src="${e}"]`)?.remove();let r=document.createElement("iframe");r.src=e,document.body.appendChild(r)}function p(e,t){let n=document.querySelector(`iframe[src="${t}"]`);n&&n.contentWindow&&e&&n.contentWindow.postMessage({source:"contentScript",msg:e},"*")}window.addEventListener("message",function(e){if(e.data&&e.data.source==="asyncTigger"){if(e.data.msg&&e.data.msg.data&&"platform"in e.data.msg.data&&"promiseId"in e.data.msg.data){let t=e.data.msg.data.promiseId;delete e.data.msg.data.promiseId;let n=s[t];n(e.data.msg.data),delete s[t];return}o("couponsToOffscreenMessenger",{message:"route-to-async-tigger-client",asyncTiggerClientMsg:e.data.msg,tabId:l,iframeSrc:e.data.msg.iframeSrc})}});function _(){return"_"+Math.random().toString(36).substring(2,11)}function a(e){let{message:t,scriptOptions:n,asyncTiggerClientMsg:r,tabId:T,iframeSrc:y}=e;if(t==="setup-platform-detection-script"){R(u);return}else if(t==="get-platform-V2"){l=T;let m=_();return p({invoke:"getPlatformV2",args:[n,m]},u),new Promise(S=>s[m]=S)}else if(t==="route-to-async-tigger-iframe"){p(r,y);return}return console.warn(`Unexpected message type received: '${t}'.`),!1}function E(e){return i[e]}var I=(0,M.default)(E,e=>{chrome.runtime.sendMessage({src:g,data:e})});chrome.runtime.onMessage.addListener(e=>{e.src===d&&I.handleMessage(e.data)});function o(e,t={}){return I.invoke(e,[t])}
