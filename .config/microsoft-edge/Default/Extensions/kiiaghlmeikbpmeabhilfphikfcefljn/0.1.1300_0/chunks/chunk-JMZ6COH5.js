import{a as Se,c as fe,d as Ke}from"./chunk-TL3QIPOO.js";import{a as oe}from"./chunk-5JMRRCOD.js";import{c as Ai,d as Pi}from"./chunk-LZ4BOSIO.js";import{a as Ti}from"./chunk-UWSVS74H.js";import{a as Ci,b as Ei,d as Ri}from"./chunk-UK623MXR.js";import{a as Ni}from"./chunk-5DIWEA5K.js";import{b as Si,e as Di}from"./chunk-C3OCDYXE.js";import{a as xi}from"./chunk-VMXEY2MG.js";import{a as $e,b as ri,c as ci,d as rn}from"./chunk-JWRT5PWI.js";import{f as ln}from"./chunk-XNQV75SS.js";import{a as Ce,e as fi}from"./chunk-35WHJZQO.js";import{a as vi}from"./chunk-NUCLT2FJ.js";import{b as H}from"./chunk-2IU7RY3W.js";import{b as hi,c as bi}from"./chunk-542QW3ZK.js";import{a as He,b as _t,d as ki,e as We}from"./chunk-JNO5G2QC.js";import{a as Ve}from"./chunk-AZABECDO.js";import{i as wi}from"./chunk-AJE3NLZ4.js";import{a as gi}from"./chunk-TOX56BBT.js";import{a as me}from"./chunk-KWORSN6K.js";import{a as pn,b as un,c as de,d as dn,e as d,g as M,n as _i,o as yi,p as ze}from"./chunk-TXXCCNWI.js";import{a as w,l as ie,m as p,n as mi,s as S,t as f,w as N}from"./chunk-CHZKSFGE.js";import{a as li,c as sn}from"./chunk-Z4H6U7OH.js";import{b as ii,g as gt,j as oi,k as ai,m as wt,t as kt}from"./chunk-LIVBINA3.js";import{a as pi,b as ui,c as cn}from"./chunk-HQ4MM2EX.js";import{E as qe,F as di,c as Ga,f as Qa,g as Ja,k as Za,o as ja,p as en,r as si,s as tn,t as on,u as an,v as nn,z as C}from"./chunk-T5WNPH4X.js";import{a as Ya,d as Xa}from"./chunk-CBPLEXH3.js";import{a as za,c as V,d as Ka}from"./chunk-HPNQXUCM.js";import{k as ni}from"./chunk-53OM6ECF.js";import{c as T,e as c}from"./chunk-3GYLW4KZ.js";var ao=T((dp,tt)=>{(function(){"use strict";var e=!!(typeof window<"u"&&window.document&&window.document.createElement),t={canUseDOM:e,canUseWorkers:typeof Worker<"u",canUseEventListeners:e&&!!(window.addEventListener||window.attachEvent),canUseViewport:e&&!!window.screen};typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return t}):typeof tt<"u"&&tt.exports?tt.exports=t:window.ExecutionEnvironment=t})()});var Vt=T((Mp,uo)=>{var Un=Ga(),Ln=function(){try{var e=Un(Object,"defineProperty");return e({},"",{}),e}catch{}}();uo.exports=Ln});var ho=T((Op,fo)=>{var mo=Vt();function Bn(e,t,i){t=="__proto__"&&mo?mo(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}fo.exports=Bn});var go=T((Fp,bo)=>{var Mn=ho(),On=Za(),Fn=Object.prototype,$n=Fn.hasOwnProperty;function qn(e,t,i){var o=e[t];(!($n.call(e,t)&&On(o,i))||i===void 0&&!(t in e))&&Mn(e,t,i)}bo.exports=qn});var _o=T(($p,ko)=>{var Vn=go(),Hn=si(),Wn=en(),wo=Ya(),zn=tn();function Kn(e,t,i,o){if(!wo(e))return e;t=Hn(t,e);for(var a=-1,n=t.length,s=n-1,r=e;r!=null&&++a<n;){var l=zn(t[a]),u=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(a!=s){var g=r[l];u=o?o(g,l,r):void 0,u===void 0&&(u=wo(g)?g:Wn(t[a+1])?[]:{})}Vn(r,l,u),r=r[l]}return e}ko.exports=Kn});var vo=T((qp,yo)=>{var Yn=on(),Xn=_o(),Gn=si();function Qn(e,t,i){for(var o=-1,a=t.length,n={};++o<a;){var s=t[o],r=Yn(e,s);i(r,s)&&Xn(n,Gn(s,e),r)}return n}yo.exports=Qn});var Co=T((Vp,xo)=>{var Jn=vo(),Zn=an();function jn(e,t){return Jn(e,t,function(i,o){return Zn(e,o)})}xo.exports=jn});var Ao=T((Hp,Eo)=>{var So=Xa(),er=Qa(),tr=Ja(),Do=So?So.isConcatSpreadable:void 0;function ir(e){return tr(e)||er(e)||!!(Do&&e&&e[Do])}Eo.exports=ir});var Ro=T((Wp,No)=>{var or=ja(),ar=Ao();function To(e,t,i,o,a){var n=-1,s=e.length;for(i||(i=ar),a||(a=[]);++n<s;){var r=e[n];t>0&&i(r)?t>1?To(r,t-1,i,o,a):or(a,r):o||(a[a.length]=r)}return a}No.exports=To});var Io=T((zp,Po)=>{var nr=Ro();function rr(e){var t=e==null?0:e.length;return t?nr(e,1):[]}Po.exports=rr});var Lo=T((Kp,Uo)=>{function sr(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}Uo.exports=sr});var Oo=T((Yp,Mo)=>{var cr=Lo(),Bo=Math.max;function lr(e,t,i){return t=Bo(t===void 0?e.length-1:t,0),function(){for(var o=arguments,a=-1,n=Bo(o.length-t,0),s=Array(n);++a<n;)s[a]=o[t+a];a=-1;for(var r=Array(t+1);++a<t;)r[a]=o[a];return r[t]=i(s),cr(e,this,r)}}Mo.exports=lr});var $o=T((Xp,Fo)=>{function pr(e){return function(){return e}}Fo.exports=pr});var Ho=T((Gp,Vo)=>{var ur=$o(),qo=Vt(),dr=nn(),mr=qo?function(e,t){return qo(e,"toString",{configurable:!0,enumerable:!1,value:ur(t),writable:!0})}:dr;Vo.exports=mr});var zo=T((Qp,Wo)=>{var fr=800,hr=16,br=Date.now;function gr(e){var t=0,i=0;return function(){var o=br(),a=hr-(o-i);if(i=o,a>0){if(++t>=fr)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}Wo.exports=gr});var Yo=T((Jp,Ko)=>{var wr=Ho(),kr=zo(),_r=kr(wr);Ko.exports=_r});var Go=T((Zp,Xo)=>{var yr=Io(),vr=Oo(),xr=Yo();function Cr(e){return xr(vr(e,void 0,yr),e+"")}Xo.exports=Cr});var Jo=T((jp,Qo)=>{var Sr=Co(),Dr=Go(),Er=Dr(function(e,t){return e==null?{}:Sr(e,t)});Qo.exports=Er});var ha=T(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});var da=function(){function e(t,i){var o=[],a=!0,n=!1,s=void 0;try{for(var r=t[Symbol.iterator](),l;!(a=(l=r.next()).done)&&(o.push(l.value),!(i&&o.length===i));a=!0);}catch(u){n=!0,s=u}finally{try{!a&&r.return&&r.return()}finally{if(n)throw s}}return o}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();st.useRoot=qr;st.useBranch=Vr;var xe=C(),ua=Gt(xe),ma=pn(),Mr=za(),fa=Gt(Mr),Or=un(),Xt=Gt(Or);function Gt(e){return e&&e.__esModule?e:{default:e}}var Qt=fa.default.helpers.makeError,Fr=fa.default.type.object;function $r(e,t){throw Qt('baobab-react/hooks.useBranch: given cursors mapping is invalid (check the "'+e+'" component).',{mapping:t})}function qr(e){if(!(0,ma.isBaobabTree)(e))throw Qt("baobab-react/hooks.useRoot: given tree is not a Baobab.",{target:e});var t=(0,xe.useState)(function(){return function(n){var s=n.children;return ua.default.createElement(Xt.default.Provider,{value:{tree:e}},s)}}),i=da(t,2),o=i[0],a=i[1];return(0,xe.useEffect)(function(){a(function(){return function(n){var s=n.children;return ua.default.createElement(Xt.default.Provider,{value:{tree:e}},s)}})},[e]),o}function Vr(e){!Fr(e)&&typeof e!="function"&&$r(name,e);var t=(0,xe.useContext)(Xt.default);if(!t||!(0,ma.isBaobabTree)(t.tree))throw Qt("baobab-react/hooks.useBranch: tree is not available.");var i=(0,xe.useState)(function(){var s=typeof e=="function"?e(t):e,r=t.tree.project(s);return r.dispatch=function(l){for(var u=arguments.length,g=Array(u>1?u-1:0),h=1;h<u;h++)g[h-1]=arguments[h];return l.apply(void 0,[t.tree].concat(g))},r}),o=da(i,2),a=o[0],n=o[1];return(0,xe.useEffect)(function(){var s=typeof e=="function"?e(t):e,r=t.tree.watch(s);return r.on("update",function(){var l=r.get();l.dispatch=function(u){for(var g=arguments.length,h=Array(g>1?g-1:0),m=1;m<g;m++)h[m-1]=arguments[m];return u.apply(void 0,[t.tree].concat(h))},n(l)}),function(){return r.release()}},[e]),a}});var ga=T(Jt=>{var ba=ha();Jt.useRoot=ba.useRoot;Jt.useBranch=ba.useBranch});var vt=c(V()),xt=c(ni());ri();function yt(...e){mi("ext_sd_debug")&&console.log("[STAND_DOWN]",...e)}function Ii(e,t){let i=(0,xt.getDomain)(location.href),o=ie.tree.get("tabId"),a=ie.tree.get([e,`${i}_${o}`]),n=ie.tree.get([e,`${i}_all`]),s=$e(),r=a>s,l=n>s;return yt(t,r,i,a,s,o),yt(t,l,i,n,s,"all"),r||l}function Ui(){return Ii("couponsDisabledSites","coupons")}function Li(){return Ii("cashbackDisabledSites","cashback")}function Bi(){let e=(0,xt.getDomain)(location.href),t=ie.tree.get(["mitDisabledSites",e]);return yt("mitDisabledSites",e,t),t}var Mi=vt.default.debounce(()=>{ie.sendMetric("track","standDownIndicator")},5e3,{leading:!0,trailing:!1}),Oi=vt.default.debounce(()=>{ie.sendMetric("track","standDownIndicator",{reason:"mit",url:location.href})},5e3,{leading:!0,trailing:!1});kt();var Z=c(V()),jt=c(Ka());sn();ri();cn();var Ct=async e=>N("activatePinnedTab",e);var Ye=e=>N("competitorCashbackCacheGet",{domain:w(),comp:e});var De=e=>N("competitorCashbackCacheRemove",{domain:w(),comp:e});var Fi=e=>N("completeTooltipSteps",{step:e});var St=(e,t)=>N("domainLocalStorageSet",{domain:w(),key:e,value:t});var $i=e=>N("getCashback",{fromSiteHub:e});var B=c(V()),Da=c(ni());rn();var oa=c(C()),aa=c(dn()),Ie=c(gi()),x=c(V());var Xe=()=>{let e=p.get("deweyResult","pageType");return N("dismissCashback",e)};var qi=e=>N("setSeenCashbackNotification",e);function Vi(){return{left:void 0,right:320,translateX:"initial"}}var zi=c(V());ln();var Hi=c(C()),Ee=c(gi()),Wi=c(V());var L=c(d()),Dt=class extends Hi.Component{constructor(...t){super(...t),this.state={hideNotification:!1}}componentDidMount(){f("track","extEmailConfirmation",{action:"displayed"})}render(){let{hideNotification:t}=this.state,{email:i}=Wi.default.get(this.props,"session");return(0,L.jsx)("div",{className:t?"disabled email-confirmation-page":"email-confirmation-page",style:{top:"0",bottom:"auto",left:"auto",right:"0"},children:(0,L.jsx)(Ee.Motion,{style:{opacity:(0,Ee.spring)(t?0:1,{stiffness:180,damping:20}),y:(0,Ee.spring)(t?!0?-100:100:0,{stiffness:180,damping:20})},children:({opacity:a,y:n})=>(0,L.jsxs)("div",{className:"email-confirmation-notification",style:{transform:`translate3d(0,${n}%,0)`,opacity:`${a}`},children:[(0,L.jsxs)("header",{children:[(0,L.jsx)(me,{}),(0,L.jsx)(Ve,{onClick:this.onClosePopup.bind(this)})]}),(0,L.jsxs)("section",{children:[(0,L.jsx)("h5",{style:{fontWeight:"600",color:"black"},children:"Please verify your email address so we can notify you when your rewards are ready to use!"}),(0,L.jsx)("br",{}),(0,L.jsxs)("h5",{children:["The email address associated with your account is"," ",(0,L.jsx)("span",{style:{fontWeight:"bold",color:"black"},children:i})]}),(0,L.jsx)("div",{className:"button-wrapper",children:(0,L.jsx)("button",{className:"primary-btn-large",onClick:this.onConfirm.bind(this),children:"Confirm"})}),(0,L.jsx)("div",{className:"link-wrapper",children:(0,L.jsx)("a",{className:"not-your-email-link",href:"https://capitaloneshopping.com/help",target:"_blank",rel:"noopener noreferrer",onClick:this.onNotYourEmailClicked.bind(this),children:"Not your email?"})})]})]})})})}async onClosePopup(){await Se({message:"dismiss"}),f("track","extEmailConfirmation",{action:"dismiss"}),p.set("emailConfirmationVisible",!1),this.setState({hideNotification:!0})}async onConfirm(){await Se({message:"confirm"}),f("track","extEmailConfirmation",{action:"confirm"}),p.set("emailConfirmationVisible",!1),this.setState({hideNotification:!0})}async onNotYourEmailClicked(){f("track","extEmailConfirmation",{action:"notYourEmail"})}},Et=de({session:["session"]},Dt);var Ki=c(d());async function Ae(){await bn()&&(ze({appName:"emailConfirmation",cssUrl:"cashback.css",app:(0,Ki.jsx)(Et,{})}),p.set("emailConfirmationVisible",!0))}async function bn(){if(p.get("emailConfirmationVisible")||!S("email_unengaged"))return!1;let e=await Se({message:"getEvents"}),t=zi.default.chain(e).pickBy(s=>new Date-new Date(s)<23328e6).value();if("hasConfirmedEmail"in t&&new Date-new Date(t.hasConfirmedEmail)<6048e5)return!1;let o="seenEmailConfirmation1"in t&&"seenEmailConfirmation2"in t&&"seenEmailConfirmation3"in t,a=new Date(Math.max(new Date(t.seenEmailConfirmation1||0),new Date(t.seenEmailConfirmation2||0),new Date(t.seenEmailConfirmation3||0))),n=a&&new Date-a<864e5;return!(o||n)}function J(e,t,i,o,{redirect:a=!1,cashback:n=!1,...s}={}){let r,l;if(window.__wb_contentId){switch(e){case"cashbackNotification":r="cashback";break;case"couponNotification":case"couponNotificationResult":r="coupons";break;case"siteHubOffers":r="sitehub";break}r&&(l=window.__wb_contentId[r])}f("track","desktopExtensionClick",{name:e,label:t?.toLowerCase(),type:i,subType:o,cashback:n,redirect:a,...s,contentId:l})}var oo=c(C()),re=c(V());var Yi=c(C()),Te=c(V());var D=c(d()),At=class extends Yi.Component{constructor(t){super(t),this.state={expanded:!1}}toggleContainerSize(t){t.preventDefault(),this.setState({expanded:!this.state.expanded})}onShowExclusion(){f("trackClick","viewExclusionDetails","view details"),window.open(`${M}/s/${this.props.tld}/coupon`,"_blank")}render(){let{expanded:t}=this.state,{center:i,couponCount:o,displayInModal:a,hasCoupons:n,reward:s,runTimeSeconds:r,showCouponCount:l,showDismiss:u,showReward:g}=this.props,h=g?s.type==="percentage"?`${s.amount/100}%`:H(s.amount,{currency:s.amountCurrency||s.currency}):"",m=3,R=s&&Te.default.get(s,"categories.length",0)>m,U=Te.default.get(s,"categories")||[],_=t?U:U.slice(0,m);return s.categories?(0,D.jsxs)("div",{className:`simple-section ${i?"center":""} ${a?"display-in-modal":""}`,children:[g&&(0,D.jsxs)("div",{className:"reward-text",children:[(0,D.jsxs)("h2",{children:["Up to ",(0,D.jsx)("span",{className:"palmetto",children:h})," in Rewards Activated"]}),l&&(0,D.jsxs)("h6",{className:"bold center",children:[o," ",o===1?" code ":" best codes "," tested in"," ",r," sec."]}),(0,D.jsxs)("h6",{className:"exclusion-text center",children:["*Rewards may vary based on exchange rates. Terms and exclusions apply",Te.default.get(this.props,"view.exclusions")?(0,D.jsxs)(D.Fragment,{children:[","," ",(0,D.jsx)("span",{className:"tertiary-link-lighter",onClick:this.onShowExclusion.bind(this),children:"view details."})]}):null]})]}),(0,D.jsxs)("div",{className:"reward-categories",children:[(0,D.jsx)("h5",{className:"bold",children:"Rewards by Category"}),(0,D.jsxs)("div",{className:`cashback-category-section ${n&&"show-border"}`,children:[(0,D.jsx)("div",{className:"cashback-category-container",children:Te.default.map(_,({name:E,amount:k,type:P})=>(0,D.jsxs)("div",{className:"cashback-category-row",children:[(0,D.jsx)("p",{className:"cashback-category-name",children:E}),(0,D.jsx)("span",{className:"cashback-category-reward",children:P==="percentage"?`${k/100}%`:H(k)})]},E))}),R&&(0,D.jsxs)("h5",{className:"toggle-container-cta",onClick:this.toggleContainerSize.bind(this),children:["Show ",this.state.expanded?"fewer":"all"," categories"]})]})]}),u&&(0,D.jsx)("div",{className:"dismiss-notif",children:(0,D.jsx)("h4",{className:"primary-link bold",onClick:this.props.onClosePopup.bind(this),children:"Continue to Checkout"})})]}):null}},Tt=At;var he=c(C());var Ge=c(d());function gn({style:e,flex:t,width:i=40,height:o=25,color:a="#adb9bf",onClick:n,marginTop:s=0,marginRight:r,marginLeft:l}){return(0,Ge.jsx)("div",{style:{...e,display:"flex",flex:t,justifyContent:"right",alignItems:"center",width:i,height:o,color:a,marginTop:s,marginRight:r,marginLeft:l},onClick:n,children:(0,Ge.jsx)("svg",{width:"28",height:"29",viewBox:"0 0 28 29",fill:"none",style:{cursor:"pointer"},"aria-label":"Settings",role:"button",xmlns:"http://www.w3.org/2000/svg",children:(0,Ge.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.9952 15.1504L23.019 18.1266V22.3506C23.019 22.9802 22.5039 23.4953 21.8743 23.4953H17.6389L14.6627 26.4715C14.2163 26.9179 13.4951 26.9179 13.0487 26.4715L10.0725 23.4953H5.84855C5.21896 23.4953 4.70385 22.9802 4.70385 22.3506V18.1152L1.72765 15.139C1.28121 14.6926 1.28121 13.9714 1.72765 13.525L4.70385 10.5488V6.32485C4.70385 5.69527 5.21896 5.18015 5.84855 5.18015H10.0725L13.0601 2.20395C13.274 1.9896 13.5643 1.86914 13.8671 1.86914C14.1699 1.86914 14.4603 1.9896 14.6741 2.20395L17.6503 5.18015H21.8743C22.5039 5.18015 23.019 5.69527 23.019 6.32485V10.5488L25.9952 13.5364C26.4416 13.9829 26.4416 14.704 25.9952 15.1504ZM6.99317 14.3379C6.99317 18.1268 10.0724 21.2061 13.8613 21.2061C17.6503 21.2061 20.7295 18.1268 20.7295 14.3379C20.7295 10.549 17.6503 7.46973 13.8613 7.46973C10.0724 7.46973 6.99317 10.549 6.99317 14.3379Z",fill:"#B4BDC2"})})})}var Nt=gn;var O=c(d());function wn(e){let[t,i]=(0,he.useState)(!1),o=s=>{let r=(0,he.useRef)();return(0,he.useEffect)(()=>{let l=()=>{s()};return document.addEventListener("click",l,!0),()=>{document.removeEventListener("click",l,!0)}},[r]),r},a=()=>{setTimeout(()=>{i(!1)})};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{style:{width:48},children:(0,O.jsx)(Nt,{onClick:()=>i(!t),style:{position:"fixed",top:14,right:15}})}),t?(0,O.jsx)(()=>(0,O.jsx)("div",{ref:o(a),className:"notification-menu",children:(0,O.jsxs)("ul",{children:[(0,O.jsx)("li",{children:(0,O.jsx)("p",{onClick:e.confirmDismiss,className:"menu-item",children:"Dismiss Notification"})}),(0,O.jsx)("li",{children:(0,O.jsx)("p",{onClick:e.snoozeNotification,className:"menu-item",children:"Snooze for 24 Hours"})})]})}),{}):null]})}var Rt=wn;var Xi=e=>()=>{e("Snooze for 24 Hours")},Qe=(e,t,i,o,a)=>{e.stopPropagation(),o?(i(t,!0),f("trackClick","dismissCompetitorClickWarning",t,{rewardAmount:a?.amount,rewardDisplay:a?.type})):i(t)};var Gi=c(d()),Je=({onUserClosePopup:e})=>e?(0,Gi.jsx)(Rt,{confirmDismiss:()=>e("Dismiss Notification"),snoozeNotification:Xi(e)}):null;var K=c(d());function kn(){f("trackClick","viewExclusionDetails","view details"),window.open(`${M}/s/${w()}/coupon`,"_blank")}function Pt({reward:e,containerStyle:t}){if(e?.type!=="threshold"&&!e?.threshold)return null;let i=p.get(["siteAPIData","siteData","merchantPage","exclusions"]);return(0,K.jsx)("div",{style:t,children:(0,K.jsx)(Ti,{side:"left",text:"*Terms and Conditions Apply",hoverTitle:"This limited time offer is available for one use only.",hoverText:(0,K.jsxs)(K.Fragment,{children:["The spend requirement must be met in a single transaction, on non-excluded items, after discounts, store credits, and redemption dollars are applied, and before taxes and shipping fees are applied.",i&&(0,K.jsxs)(K.Fragment,{children:[" ","Exclusions apply,"," ",(0,K.jsx)("span",{className:"tertiary-link-lighter",onClick:kn,children:"view details"}),"."]})]})})})}var Ji=c(pi());var Ze=c(C());var _n=["data:image/jpeg;base64,","data:image/png;base64,","data:image/webp;base64,"];async function It(e){try{let t=await fetch(e).then(o=>o.blob());return await new Promise(o=>{let a=new window.FileReader;a.onload=()=>{let n=a.result,s=!!n&&_n.some(r=>n.startsWith(r));o(s?n:null)},a.readAsDataURL(t)})}catch{return null}}function Ne(e){let[t,i]=(0,Ze.useState)("");return(0,Ze.useEffect)(()=>{async function o(){i(await It(e))}e&&o()},[e]),t}var b=c(d());function yn(){return(0,b.jsx)("svg",{width:"129px",height:"128px",viewBox:"0 0 159 158",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:{height:"100%"},children:(0,b.jsxs)("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:[(0,b.jsxs)("g",{transform:"translate(1.508527, 0.595868)",children:[(0,b.jsx)("mask",{id:"mask-2",fill:"white",children:(0,b.jsx)("polygon",{points:"0.0159903815 0.158395289 156.744206 0.158395289 156.744206 156.886611 0.0159903815 156.886611"})}),(0,b.jsx)("path",{d:"M156.744357,78.5224278 C156.744357,121.802055 121.659046,156.886611 78.3801738,156.886611 C35.1013011,156.886611 0.0159903815,121.802055 0.0159903815,78.5224278 C0.0159903815,35.2435551 35.1013011,0.158244436 78.3801738,0.158244436 C121.659046,0.158244436 156.744357,35.2435551 156.744357,78.5224278",fill:"#E8E9E9",mask:"url(#mask-2)"})]}),(0,b.jsx)("mask",{id:"mask-4",fill:"white",children:(0,b.jsx)("polygon",{points:"0 157.48263 158.252733 157.48263 158.252733 0.754263279 0 0.754263279"})}),(0,b.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 99.6562815 139.51985 99.6562815 139.51985 37.1844254 21.114092 37.1844254"}),(0,b.jsx)("polygon",{stroke:"#177C3E",strokeWidth:"3.852",mask:"url(#mask-4)",points:"27.0803145 94.3138347 133.554382 94.3138347 133.554382 43.1167061 27.0803145 43.1167061"}),(0,b.jsx)("path",{d:"M27.0803145,81.4809501 L27.0803145,94.3139856 L39.9141042,94.3139856 C39.9141042,87.2261735 34.1681266,81.4809501 27.0803145,81.4809501",fill:"#177C3E",mask:"url(#mask-4)"}),(0,b.jsx)("path",{d:"M39.9138779,43.1166307 L27.0800882,43.1166307 L27.0800882,55.9504204 C34.1686545,55.9504204 39.9138779,50.205197 39.9138779,43.1166307",fill:"#177C3E",mask:"url(#mask-4)"}),(0,b.jsx)("path",{d:"M133.554457,55.9501187 L133.554457,43.116329 L120.719913,43.116329 C120.719913,50.204141 126.465891,55.9501187 133.554457,55.9501187",fill:"#177C3E",mask:"url(#mask-4)"}),(0,b.jsx)("path",{d:"M120.720969,94.314061 L133.554005,94.314061 L133.554005,81.4802713 C126.466193,81.4802713 120.720969,87.226249 120.720969,94.314061",fill:"#177C3E",mask:"url(#mask-4)"}),(0,b.jsx)("path",{d:"M96.1528794,68.4205043 C96.1528794,78.3828137 89.0635589,86.4602192 80.3171219,86.4602192 C71.5714392,86.4602192 64.4821186,78.3828137 64.4821186,68.4205043 C64.4821186,58.4574407 71.5714392,50.3807895 80.3171219,50.3807895 C89.0635589,50.3807895 96.1528794,58.4574407 96.1528794,68.4205043",fill:"#177C3E",mask:"url(#mask-4)"}),(0,b.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 102.9856 139.51985 102.9856 139.51985 99.6562815 21.114092 99.6562815"}),(0,b.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 106.314918 139.51985 106.314918 139.51985 102.9856 21.114092 102.9856"}),(0,b.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 109.64499 139.51985 109.64499 139.51985 106.315672 21.114092 106.315672"}),(0,b.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 112.974308 139.51985 112.974308 139.51985 109.64499 21.114092 109.64499"}),(0,b.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 116.303626 139.51985 116.303626 139.51985 112.974308 21.114092 112.974308"}),(0,b.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 119.632944 139.51985 119.632944 139.51985 116.303626 21.114092 116.303626"}),(0,b.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 122.962263 139.51985 122.962263 139.51985 119.63219 21.114092 119.63219"}),(0,b.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 126.291581 139.51985 126.291581 139.51985 122.962263 21.114092 122.962263"}),(0,b.jsx)("polygon",{fill:"#F2F2F2",mask:"url(#mask-4)",points:"73.0526614 99.6562815 87.5812807 99.6562815 87.5812807 37.1844254 73.0526614 37.1844254"}),(0,b.jsx)("polygon",{fill:"#C6C6C5",mask:"url(#mask-4)",points:"73.0526614 126.291581 87.5812807 126.291581 87.5812807 99.6562815 73.0526614 99.6562815"}),(0,b.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"8.87013617 131.013269 38.2011723 131.013269 38.2011723 126.208612 8.87013617 126.208612"}),(0,b.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"2.98235701 126.208612 32.3133932 126.208612 32.3133932 121.4032 2.98235701 121.4032"}),(0,b.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"3.09775929 121.4032 32.4287954 121.4032 32.4287954 116.598543 3.09775929 116.598543"}),(0,b.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"5.92624659 116.598543 35.2572827 116.598543 35.2572827 111.793132 5.92624659 111.793132"}),(0,b.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"2.98235701 111.793886 32.3133932 111.793886 32.3133932 106.988475 2.98235701 106.988475"}),(0,b.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"-0.000754263279 106.988475 29.3302819 106.988475 29.3302819 102.183818 -0.000754263279 102.183818"}),(0,b.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"5.92624659 102.183818 35.2572827 102.183818 35.2572827 97.3784064 5.92624659 97.3784064"}),(0,b.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"2.94388958 97.3784064 32.2749257 97.3784064 32.2749257 92.5737493 2.94388958 92.5737493"})]})})}var Qi=yn;var be=c(d()),vn="https://images.capitaloneshopping.com/api/v1/logos",xn=({domain:e,width:t=300,height:i=300})=>{let o=Ne(`${vn}?${Ji.default.stringify({domain:e,width:t,height:i})}`);return fi()?(0,be.jsx)("div",{className:"partner-logo-component",children:o===null?(0,be.jsx)("div",{className:"partner-logo",children:(0,be.jsx)(Qi,{})}):o?(0,be.jsx)("div",{className:"partner-logo success",style:{backgroundImage:`url("${o}")`}}):(0,be.jsx)("div",{className:"partner-logo"})}):null},Ut=xn;var Y=c(d());function je({reward:e}){if(!e?.tiers?.length)return null;let t={currency:e.amountCurrency||e.currency,truncateIntegers:!0};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)("h3",{className:"bold mt-3",id:"threshold-tiers","aria-hidden":!0,children:"Rewards by Spend"}),(0,Y.jsx)("ol",{"aria-labelledby":"threshold-tiers",children:e.tiers.map((i,o)=>{let a=o<e.tiers.length-1,n=`Spend ${H(i.spendCents||i.spend_cents,t)?.replace(a?/[ A-Z]/g:"","")}${a?"-"+H(e.tiers[o+1].spendCents||e.tiers[o+1].spend_cents,t):"+"}`,s=i.reward.type==="percentage"?`${i.reward.value/100}% back`:H(i.reward.value,t);return(0,Y.jsxs)("li",{className:"flex text-sm bold mt-2","aria-label":`${n}, earn ${s}`,children:[(0,Y.jsx)("span",{className:"grow text-neutralsecondary","aria-hidden":!0,children:n}),(0,Y.jsx)("span",{className:"shrink-0 whitespace-nowrap text-[#0276b1] pl-4","aria-hidden":!0,children:s})]},o)})})]})}var Zi=c(C());var ae=c(d()),Cn=e=>e>160&&e<171?e:160;function Sn(e){let[t,i]=(0,Zi.useState)(!1),o=Cn(e.exclusions.length),a=e.exclusions.length,n=e.exclusions.substring(0,o);return(0,ae.jsxs)("div",{className:"website-exclusions",children:[(0,ae.jsx)("h5",{className:"bold",children:"Exclusions Apply:"}),(0,ae.jsx)("p",{children:t?e.exclusions:`${n}${a>o?"...":""}`}),a>o?(0,ae.jsx)("div",{className:"exclusion-expand",children:(0,ae.jsx)("span",{className:"exclusion-expand-text",onClick:()=>i(!t),children:t?"Collapse":"Expand"})}):null]})}var Lt=Sn;var to=c(C()),io=c(V());function ne(e){return["wayfair.com","wayfair.ca","jossandmain.com","birchlane.com","allmodern.com","trade.wayfair.com","perigold.com"].includes(e)}var W=c(d()),Dn=({onDetailsClick:e,exclusions:t=!0,...i})=>w()==="quill.com"?(0,W.jsx)("p",{style:{color:"#a2adb4",fontSize:"12px",fontWeight:"normal",marginTop:"10px",lineHeight:"1.25em"},children:"*All HP, Epson, and Samsung products are excluded from coupons, discounts, and rewards offers."}):ne(w())?(0,W.jsx)("p",{style:{color:"#a2adb4",fontSize:"12px",fontWeight:"normal",marginTop:"10px",lineHeight:"1.25em"},children:"*Items in cart prior to rewards activation will not be eligible for rewards."}):(0,W.jsxs)("h6",{...i,children:[(0,W.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,W.jsxs)("span",{children:["Rewards may vary based on exchange rates.",t&&(0,W.jsxs)(W.Fragment,{children:[" ","Terms and exclusions apply,",(0,W.jsxs)("span",{className:"tertiary-link-lighter",onClick:e,children:[" ","view details."]})]})]})]}),Bt=Dn;var ji=c(C()),eo=c(V());var j=c(d()),Mt=class extends ji.Component{constructor(...t){super(...t),this.state={}}componentWillMount(){}componentDidMount(){this.props.isCreditsReminderMessage&&setTimeout(()=>{f("page","creditIgnoreTooltip",{view:"cashbackNotification",type:"tooltip"}),chrome.storage.local.set({seenCreditsReminder:Date.now()})},Number(this.props.delay.replace("ms","")))}getCtaButtonText(){let t;try{let i=p.get(["shadowRootsByAppName","notification"]);if(i){let o=i();o&&(t=o.querySelector(".primary-btn-large").textContent)}}catch{}return t}render(){let{tipLabel:t,message:i,isCreditsReminderMessage:o}=this.props,a=this.props.style||{};if(this.props.delay){let n={animationDelay:this.props.delay};a=eo.default.merge(n,a)}return(0,j.jsx)("div",{style:a,className:`new-tooltip ${this.props.position||""}${o?" credits-reminder":""}`,children:(0,j.jsxs)("div",{style:this.props.innerStyle||{},onClick:this.props.onDismissTooltip.bind(this),className:"new-tooltip-wrapper",children:[(0,j.jsx)("div",{className:"close icon-x"}),o?(0,j.jsx)("div",{className:`triangle ${o?"credits-reminder":""}`}):null,(0,j.jsxs)("h2",{children:[this.props.tip?(0,j.jsx)("span",{className:"bold",children:t||"tip:"}):null,i]})]})})}},ge=Mt;var we=c(d());function En(e,{capitalize:t=!0}={}){return e.type==="threshold"&&e.threshold?t?"Earn ":"earn ":t?"Get ":"get "}function An(e,{capitalizeUpTo:t=!1,hideUpTo:i=!1}={}){let o=!i&&(e.categories||e.estimated)?t?"Up to ":"up to ":"",a=e.tiers?.length?e.tiers[e.tiers.length-1].reward.type:e.type,n=e.tiers?.length?e.tiers[e.tiers.length-1].reward.value:e.amount,s=a==="percentage"?`${n/100}%`:H(n,{currency:e.amountCurrency||e.currency,truncateIntegers:!0}),r="";if(e.maxPayoutAmount){let l=H(e.maxPayoutAmount,{currency:e.maxPayoutAmountCurrency,truncateIntegers:!0});r+=` (${l} max)`}return o+s+r}function Tn(e){let t="";if(e.type==="threshold"&&e.threshold){let i=e.tiers?.length?e.tiers[e.tiers.length-1].spendCents||e.tiers[e.tiers.length-1].spend_cents:e.threshold,o=H(i,{currency:e.amountCurrency||e.currency,truncateIntegers:!0});t.length>0&&(t+=","),t+=` when you spend ${o}`}return" back"+t}function et(e,{hidePrefix:t=!1,hideSuffix:i=!1}={}){return(0,we.jsxs)(we.Fragment,{children:[!t&&En(e),(0,we.jsx)("span",{className:"brand",children:An(e)}),!i&&Tn(e)]})}var I=c(d()),Ot=class extends to.Component{constructor(t){super(t),this.state={isLoggedIn:oe()},this.ebatesComparisonSiteList=["macys.com","oakley.com","puritanspride.com","ebay.com","walmart.com","marriott.com","sephora.com","zulily.com","tirerack.com","ancestry.com","samsclub.com","samsung.com","nordvpn.com","priceline.com","qvc.com","microsoftstore.com","starwoodhotels.com","discounttire.com","officedepot.com","lifelock.com","omahasteaks.com","woot.com","coursera.org","sixt.com","wsj.com","gilt.com"]}componentWillReceiveProps(t){t.showCreditsReminder!==this.state.showCreditsReminder&&!this.state.didDismiss&&this.setState({showCreditsReminder:t.showCreditsReminder})}renderHeadline(){return(0,I.jsx)("h2",{children:et(this.props.view.reward)})}render(){let i=!Ce(w()),o=this.props.activating&&!this.state.hasClickedToLogin,a=this.props.activated&&!this.state.hasClickedToLogin,{reward:n,vendor:s}=this.props.view,r=o||a,l=n.amount/100>=5||!!n.categories,u="Ok";return(0,I.jsxs)("div",{className:"simple-section",children:[r?(0,I.jsxs)("h2",{children:["Activating ",et(n,{hidePrefix:!0})]}):l?this.renderHeadline():(0,I.jsx)("h2",{children:"Found Rewards"}),(0,I.jsxs)("h4",{className:"bold",children:["at ",s,"."]}),(0,I.jsx)("div",{className:"button-wrapper",children:oe()?(0,I.jsxs)(I.Fragment,{children:[this.renderControl(u),w()==="quill.com"||ne(w())?(0,I.jsx)(Bt,{}):null,this.state.showCreditsReminder&&!(a||o)?(0,I.jsx)(ge,{tip:!0,isCreditsReminderMessage:!0,tipLabel:"Activating Shopping Rewards is completely free.",message:(0,I.jsx)("span",{className:"dismiss-text",children:"Click the \u201COk\u201D button to activate Rewards on your purchases that you can redeem for gift cards at top stores."}),delay:"7000ms",style:{top:"50%",transform:"translateY(-50%)",width:"360px",right:"calc(100% + 16px)"},onDismissTooltip:this.onDismissTooltip.bind(this)}):null]}):(0,I.jsx)("button",{className:`primary-btn-large ${i?"red-btn":""} ${S("notif_rounded_border")?"rounded-btn":""}`,onClick:this.onClickSignIn.bind(this),children:u})})]})}renderControl(t){let o=!Ce(w()),a=this.props.activating&&!this.state.hasClickedToLogin;return this.props.activated&&!this.state.hasClickedToLogin?(0,I.jsx)("button",{className:`primary-btn-large ${S("notif_rounded_border")?"rounded-btn":""}`,disabled:!0,children:"Activated"}):a?(0,I.jsx)("button",{className:`primary-btn-large ${S("notif_rounded_border")?"rounded-btn":""}`,disabled:!0,children:"Activating"}):(0,I.jsx)("button",{className:`primary-btn-large ${o?"red-btn":""} ${S("notif_rounded_border")?"rounded-btn":""}`,onClick:s=>{s.stopPropagation(),this.props.onActivate({label:t})},children:t})}async onClickSignIn(t){t.stopPropagation(),this.setState({hasClickedToLogin:!0});let i=io.default.get(this.props.view,"vendor"),o=await Ke();this.props.onActivate({preventHide:!this.state.hasClickedToLogin,shouldLoadEmailCreateAccountNotification:o}),f("track","signinRequired",{vendor:i}),o||window.open(`${M}/sign-in`)}},Ft=Ot;var y=c(d()),$t=class extends oo.Component{constructor(t){super(t),this.state={}}onShowExclusion(){f("trackClick","viewExclusionDetails","view details"),window.open(`${M}/s/${re.default.get(this.props.view,"deweyResult.domain")}/coupon`,"_blank")}onConfirmDismiss(){let t=re.default.get(this.props,"reward",{});f("trackClick","dismissCreditReminder","",{rewardAmount:t.amount,rewardDisplay:t.type}),this.props.onUserClosePopup("activate later",!0)}onShowNewUserDetails(){f("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}render(){let{activating:t,activated:i}=this.props,o=!!re.default.get(this.props,"reward.categories"),a=this.props.hasActivatedCompetitor,n=this.props.eligibleForNewUserBonus,s=re.default.get(this.props.view,"reward"),r="No thanks, I don't want rewards",l=this.props.view.exclusions;return(0,y.jsxs)("div",{className:"cash-back-resolve",style:this.props.isLandscape?{padding:"20px 24px 0 0"}:void 0,children:[(0,y.jsx)(Je,{hasActivatedCompetitor:a,onUserClosePopup:this.props.onUserClosePopup,reward:s}),(0,y.jsxs)("div",{className:"credit-prompt",children:[(0,y.jsx)(Ut,{domain:w()}),(0,y.jsxs)("div",{children:[S("show_rewards")&&(0,y.jsx)("div",{className:"rewards-activation",children:(0,y.jsx)(Ft,{...this.props,onShowExclusion:this.onShowExclusion.bind(this)})}),!t&&!i&&!a?(0,y.jsx)(y.Fragment,{children:(0,y.jsx)("h4",{className:"bold activate-later tertiary-link",onClick:u=>Qe(u,r,this.props.onUserClosePopup,a,s),children:r})}):(i||t)&&(0,y.jsxs)("div",{children:[(0,y.jsxs)("h6",{style:{display:"flex",marginTop:"6px",paddingLeft:"3px",fontSize:"8px",lineHeight:"10px",paddingBottom:"10px",marginBottom:o?"15px":0,borderBottom:o?"1px solid #dedede":0},children:[(0,y.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,y.jsxs)("span",{children:["Rewards may vary based on exchange rates.",re.default.get(this.props,"view.exclusions")?(0,y.jsxs)(y.Fragment,{children:[" ","Terms and exclusions apply,",(0,y.jsx)("span",{style:{paddingLeft:"3px"},className:"tertiary-link-lighter",onClick:this.onShowExclusion.bind(this),children:"view details."})]}):null]})]}),o?(0,y.jsx)(Tt,{reward:this.props.reward,tld:re.default.get(this.props.view,"deweyResult.domain")}):null,(0,y.jsx)(je,{reward:this.props.reward}),(i||t)&&l?(0,y.jsx)("div",{style:{paddingTop:"20px"},children:(0,y.jsx)(Lt,{exclusions:l})}):null]}),(0,y.jsx)(Pt,{reward:s,containerStyle:{marginTop:12,textAlign:"left"}}),n&&(0,y.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,y.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,y.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]})]})]})]})}},qt=$t;var ee=c(C());kt();var at=c(V());var no=c(C()),Nn=c(ao());var ro=c(C());var so=c(C());var co=c(C());var lo=c(C());var po=c(C());var In=c(C());var Ar=c(Jo());function it(e,t){var i=t===void 0?{}:t,o=i.currency,a=o===void 0?"USD":o,n=i.country,s=n===void 0?"US":n,r=i.noDollarSign,l=r===void 0?!1:r,u=i.roundToNearestInteger,g=u===void 0?!1:u,h=i.floorToInteger,m=h===void 0?!1:h,R=i.truncateIntegers,U=R===void 0?!1:R;if(e==null||!Number.isFinite(e))return null;var _=e,E="en-".concat(s==="CA"||s==="AU"||s==="GB"?"US":s);g?_=Math.round(_):m&&(_=Math.floor(_));var k=_.toLocaleString(E,{style:"currency",currency:a==="CAD"||a==="AUD"?"USD":a,minimumFractionDigits:U&&Number.isInteger(_)?0:2});if(l){var P=s==="GB"?"\xA3":"$";k=k.replace(P,"")}return a==="CAD"&&(k+=" CAD"),a==="AUD"&&(k+=" AUD"),a==="GBP"&&(k+=" GBP"),k}var ke=c(C());function Zo({pseudoDomain:e,baobabBranch:t,contentProps:i}){let o=[t,"conquest"],[a,n]=(0,ke.useState)(),[s,r]=(0,ke.useState)(),[l,u]=(0,ke.useState)(!0),g=async()=>{let h=p.select(o);try{u(!0),h.set({loading:!0,error:null,data:null});let m=await Pi({pseudoDomain:e,contentProps:i,context:Ri()});m.error?(n(void 0),r(m.error),h.set(o,{loading:!1,data:null,error:m.error})):(n(m),r(void 0),h.set(o,{loading:!1,data:m,error:null}))}catch(m){let R=m;r(R.toString()),h.set(o,{data:null,error:R,loading:!1})}finally{u(!1)}};return(0,ke.useEffect)(()=>{g()},[]),{baobabSelector:o,data:a,error:s,loading:l}}var ea=c(C());var jo=c(C()),ot=(0,jo.createContext)({onUserClosePopup:()=>{},hasActivatedCompetitor:!1,reward:null});var Ht=c(d()),ta=({children:e})=>{let{onUserClosePopup:t,hasActivatedCompetitor:i,reward:o}=(0,ea.useContext)(ot);return t==null?null:(0,Ht.jsx)(wi,{variant:"tertiary",className:"mb-2 w-full",onClick:a=>Qe(a,e,t,i,o),children:(0,Ht.jsx)("span",{className:"text-gray-400 cursor-pointer font-semibold",children:e})})};var X=c(d());ki(e=>{e("sp-energy-cashback-dismissal",ta)});var ia=(0,ee.memo)(({reward:e,onUserClosePopup:t,hasActivatedCompetitor:i,onActivate:o})=>{let[a,n]=(0,ee.useState)(!1),[s,r]=(0,ee.useState)(!1),[l,u]=(0,ee.useState)(!1),g=w(),h={reward:e,domain:g},{data:m,error:R,loading:U}=Zo({pseudoDomain:g,baobabBranch:"energyCashback",contentProps:h}),_=(0,ee.useCallback)((0,at.debounce)(async P=>{if("eventName"in P&&P.eventName==="activate_energy_cashback"){n(!0);try{await o({label:"Activate Rewards"}),r(!0)}catch{u(!0)}finally{n(!1)}}},350),[]);if(U)return(0,X.jsx)("div",{className:"flex p-6 justify-center items-center",children:(0,X.jsx)(Ni,{})});if(R||!m?.notification)return(0,X.jsx)("div",{className:"flex p-6 justify-center items-center",children:(0,X.jsx)("p",{className:"text-critical",children:"Encountered an error retrieving content"})});let E=it(e.amount/100,{currency:e.amountCurrency||e.currency,truncateIntegers:!0}),k=ai(ii(new Date,1),"MMMM d");return(0,X.jsxs)(ot.Provider,{value:{onUserClosePopup:t,hasActivatedCompetitor:i,reward:e},children:[(0,X.jsx)(Je,{hasActivatedCompetitor:i,onUserClosePopup:t,reward:e}),(0,X.jsx)(We,{client:He.DESKTOP_WEB,data:{isActivating:a,isActivated:s,hasActivationError:l,domain:w(),reward:E,expirationDate:k},config:{rootEl:"div",logLevel:void 0},content:m.notification.blocksTemplate,onEvent:_,children:(0,X.jsx)("style",{children:".object-contain { object-fit: contain; }"})})]})},({reward:e,hasActivatedCompetitor:t},{reward:i,hasActivatedCompetitor:o})=>(0,at.isEqual)(e,i)&&t===o);var nt=e=>(p.get(["energyCashbackDomains"])||[]).includes(e);var te=c(d());function Tr(){return{left:"auto",right:"655px"}}function Nr({offerSignUp:e,storeName:t,hideNotification:i,onDismissTooltip:o,hasSeenCashbackSignupTip:a,hasSeenCashbackActivateTip:n,wrapperStyle:s={}}){let r=Tr();return(0,te.jsxs)("div",{style:s,children:[!a&&e&&!i?(0,te.jsx)(ge,{tip:!0,message:(0,te.jsxs)("span",{children:["Capital One Shopping can help you save ",(0,te.jsx)("br",{}),"on ",t," today, just click activate. It's easy and free money."]}),delay:"1500ms",style:{top:"15px",bottom:"auto",width:"461px",left:r.left,right:r.right},onDismissTooltip:o.bind(null,"hasSeenCashbackSignupTip")}):null,!n&&!e&&!i?(0,te.jsx)(ge,{tip:!0,tipLabel:"Capital One Shopping tip:",message:(0,te.jsx)("span",{children:"Just click when you see this to get free money, seriously."}),delay:"1500ms",style:{top:"15px",bottom:"auto",width:"468px",left:r.left,right:r.right},onDismissTooltip:o.bind(null,"hasSeenCashbackActivateTip")}):null]})}var Re=Nr;var z=c(d()),Wt=class extends oa.Component{constructor(...t){super(...t),this.state={hideNotification:S("ext_rewards_remove_delay")?this.props.view&&x.default.get(this.props,"view.user.activated"):!0,hasSentPossibleExpMetric:!1}}async componentWillReceiveProps(t){this.props&&t&&!this.props.warnAboutStandDown&&t.warnAboutStandDown&&this.state.activated&&this.setState({hideNotification:!1,hasSentPageNotification:!1,activated:!1,activating:!1,hasActivated:!0})}async componentDidUpdate(t,i){if(i.hideNotification!==this.state.hideNotification&&this.sendCashbackPageEvent(),t.warnAboutStandDown!==this.props.warnAboutStandDown&&this.props.warnAboutStandDown&&!p.get("throttleCreditsReactivation")){let o=await Ue();p.merge({cashback:o}),await se("reactivate")}}componentDidMount(){let t=this.props.view&&x.default.get(this.props,"view.user.activated");setTimeout(()=>{document.querySelector("#honeyContainer")&&this.setState({compNotifLoaded:!0,rightOffset:"300px"}),(document.querySelector(".ebates-notification")||document.querySelector(".ebates-hover.ebates-hover-top"))&&this.setState({compNotifLoaded:!0,rightOffset:"410px"}),S("ext_rewards_remove_delay")||this.setState({hideNotification:t}),this.sendCashbackPageEvent(),qi()},S("ext_rewards_remove_delay")?0:1e3)}async sendCashbackPageEvent(){let t=(0,aa.findDOMNode)(this),i="",o="";if(t){let a=t.querySelector("button");a&&a.textContent&&(i=a.textContent.toLowerCase())}!this.state.hideNotification&&!this.state.hasSentPageNotification&&_e()&&(this.setState({hasSentPageNotification:!0}),f("page","cashbackNotification",{view:"cashbackNotification",type:"notification",source:"cashback",deweyResult:x.default.get(this.props.view,"deweyResult.pageType"),offerSignUp:x.default.get(this.props.view,"offerSignUp"),qualified:x.default.get(this.props.view,"qualified",!1),balance:x.default.get(this.props.view,"balance",0),promotionalRate:void 0,vendorMetaId:x.default.get(this.props.view,"id"),token:x.default.get(this.props.view,"token"),ctaText:i,notificationText:o}))}trackFirstDragEnd=x.default.once((t,i)=>{Ei("cashbackNotification",t,i)});render(){let{hideNotification:t}=this.state,i=x.default.get(this.props.view,"offerSignUp"),o=x.default.get(this.props.view,"vendor");if(this.props.couponsVisible&&!(this.props.couponView&&this.props.couponView.isQuietSavingsMiss)&&!this.props.view.autoActivate||!_e())return!this.state.hasSentPossibleExpMetric&&!_e()&&(this.setState({hasSentPossibleExpMetric:!0}),f("page","possibleExperience",{type:null,source:"credits",notificationText:"credits"})),null;let a=x.default.get(this.props,"view.reward"),n=Vi();return(0,z.jsxs)(Ci,{onClick:()=>this.setState({fullScreen:!1}),className:`${t?"disabled cashback-page":"cashback-page"}`,style:{top:"0",bottom:"auto",left:n.left??"auto",right:n.right??"0",translate:n.translateX},dragSelector:"header",onDragEnd:this.trackFirstDragEnd,children:[(0,z.jsx)(Ie.Motion,{style:{opacity:(0,Ie.spring)(t?0:1,{stiffness:180,damping:20}),tabOpacity:t?0:1,y:(0,Ie.spring)(t?-100:0,{stiffness:180,damping:20}),tabX:t?80:0},children:({opacity:s,y:r})=>(0,z.jsxs)("div",{className:`cashback-notification ${S("notif_rounded_border")?"rounded-notification":""}`,style:{transform:`translate3d(0,${r}%,0)`,opacity:`${s}`},children:[(0,z.jsxs)("header",{className:"reward-header",children:[(0,z.jsx)(me,{}),(0,z.jsx)(Ai,{})]}),nt(w())?(0,z.jsx)(ia,{reward:a,onUserClosePopup:this.onUserClosePopup.bind(this),hasActivatedCompetitor:this.props.hasActivatedCompetitor,onActivate:this.determineRunCashback.bind(this)}):(0,z.jsx)(qt,{view:this.props.view,hasActivated:this.state.hasActivated,hasActivatedCompetitor:this.props.hasActivatedCompetitor,reward:a,activated:this.state.activated,activating:this.state.activating,hasCoupons:x.default.get(this.props,"view.hasCoupons"),session:this.props.session,showInitialSignup:this.state.showInitialSignup,tld:this.props.tld,activate:this.state.activate,onActivate:this.determineRunCashback.bind(this),dismissNotification:()=>this.setState({hideNotification:!0}),hasSeenFTUX:x.default.get(this.props,"events.hasSeenCashbackFtux",!1),onUserClosePopup:this.onUserClosePopup.bind(this),deweyResult:x.default.get(this.props.view,"deweyResult"),setSeenCashbackFtux:this.setSeenCashbackFtux.bind(this),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus})]})}),(0,z.jsx)(Re,{offerSignUp:i,storeName:o,hideNotification:t,onDismissTooltip:this.onDismissTooltip.bind(this),hasSeenCashbackSignupTip:x.default.get(this.props,"events.hasSeenCashbackSignupTip"),hasSeenCashbackActivateTip:x.default.get(this.props,"events.hasSeenCashbackActivateTip")})]})}determineRunCashback(t){return oe()?this.onActivate(t):(t?.shouldLoadEmailCreateAccountNotification&&this.setState({hideNotification:!0},()=>{fe()}),Le())}onDismissTooltip(t){x.default.get(this.props,`events.${t}`)||Pe(t)}async onActivate(t={}){let i=x.default.get(this.props.view,"reward",{}),a=x.default.get(this.props.view,"hasCoupons")?1500:5e3;this.setState({activating:!0}),this.onDismissTooltip("hasSeenCashbackActivateTip");let{isRedirectEnabled:n}=await ye({reward:i,view:t.view,label:t.label});this.setState({activated:!0}),t.preventHide||setTimeout(()=>{this.setState({hideNotification:!0},()=>{n||fe(i)})},a),Ae()}onUserClosePopup(t,i=!1){let o=x.default.get(this.props.view,"reward",{});(x.default.get(this.props.view,"user.hasSeenFirst")||x.default.get(this.props.view,"isCashbackURLMatch"))&&Xe(),this.setState({hideNotification:!0}),x.default.get(this.props.view,"offerSignUp")?this.onDismissTooltip("hasSeenCashbackSignupTip"):this.onDismissTooltip("hasSeenCashbackActivateTip"),i||(f("trackClick","dismissCashbackNotification",t,{rewardAmount:o.amount,rewardDisplay:o.type}),J("cashbackNotification",t,"dismiss","primary",{rewardAmount:o.amount,rewardDisplay:o.type}))}setSeenCashbackFtux(){Pe("hasSeenCashbackFtux")}},zt=de({view:["cashbackView"],couponView:["couponView"],deweyResult:["deweyResult"],events:["events"],session:["session"],settings:["settings"],tld:["siteAPIData","siteData","tld"],hasActivatedCompetitor:["hasActivatedCompetitor"],warnAboutStandDown:["warnAboutStandDown"],couponsVisible:["couponsVisible"]},Wt);var F=c(C()),ve=c(V());var Kt=()=>N("setReactivateNotifThrottled",{domain:w()});var v=c(d()),Rr=({children:e})=>(0,v.jsx)("div",{className:"bg-overlay flex justify-center items-center fixed top-0 left-0 w-screen h-screen z-[9999]",children:e}),Pr=({children:e})=>(0,v.jsx)("div",{className:"bg-white rounded-lg flex flex-col items-center p-2 w-[400px] h-[240px]",children:e}),Ir=({children:e})=>(0,v.jsx)("div",{className:"mt-2 flex justify-between w-full",children:e}),Ur=({children:e})=>(0,v.jsx)("div",{className:"flex flex-col items-center mt-8 w-full",children:e}),Lr=e=>{let t=p.get("cashback"),[i,o]=(0,F.useState)(e.hasActivatedCompetitor||e.warnAboutStandDown),[a,n]=(0,F.useState)(ve.default.get(t,"user.compInactivated")),[s,r]=(0,F.useState)(a&&i),[l,u]=(0,F.useState)(!1),[g,h]=(0,F.useState)(!1),[m,R]=(0,F.useState)("Re-activate Rewards"),U=(0,F.useState)(ve.default.get(e.view,"reward",{})),_=ve.default.get(e,"view.exclusions");(0,F.useEffect)(()=>{na(e.tld)},[]),(0,F.useEffect)(()=>{s&&f("page","rewardsReactivation",{view:"rewardsReactivation",type:"notification"})},[s]);let E=async()=>{let $=await Ue();p.merge({cashback:$}),n(ve.default.get(p.get("cashback"),"user.compInactivated")),o(e.hasActivatedCompetitor||e.warnAboutStandDown)};(0,F.useEffect)(()=>{(e.hasActivatedCompetitor||e.warnAboutStandDown)&&E()},[e.hasActivatedCompetitor,e.warnAboutStandDown]),(0,F.useEffect)(()=>{a&&i&&r(!0)},[a,i]);let k=async()=>{let q=`${p.get(["couponView","hasDeferredCouponRewards"])?"Activate":"Re-activate"} Rewards`;return R(q),q};(0,F.useEffect)(()=>{k()},[U]);let P=async($={})=>{u(!0),await ye({reward:U,view:"cashbackReactivate",label:m}),u(!1),h(!0),Kt(),setTimeout(()=>r(!1),1e3)},le=()=>{f("trackClick","viewExclusionDetails","view details"),window.open(`${M}/s/${e.tld}/coupon`,"_blank")},Q=($,pe=!1)=>{let q=ve.default.get(e.view,"reward",{});r(!1),pe||(f("trackClick","dismissCashbackNotification",$,{rewardAmount:q.amount,rewardDisplay:q.type}),J("rewardsReactivation",$,"dismiss","primary",{rewardAmount:q.amount,rewardDisplay:q.type})),Kt()};return(0,v.jsx)(v.Fragment,{children:s?(0,v.jsx)(Rr,{children:(0,v.jsxs)(Pr,{children:[(0,v.jsxs)(Ir,{children:[(0,v.jsx)(me,{}),(0,v.jsx)(Ve,{onClick:()=>{Q(m)}})]}),(0,v.jsxs)(Ur,{children:[(0,v.jsx)("p",{className:"text-2xl leading-9 font-bold text-neutralprimary",children:"Oops! Rewards were disabled."}),(0,v.jsx)("p",{className:"leading-6 text-neutralsecondary",children:"You used another coupon site."}),l?(0,v.jsx)("h5",{className:"bold rewards-only-button red",children:"Activating..."}):g?(0,v.jsx)("h5",{className:"bold rewards-only-button red",children:"Activated!"}):(0,v.jsx)("button",{className:"primary-btn-large red-btn",style:{width:"90%",marginTop:"16px"},onClick:P,children:m}),(l||g)&&(0,v.jsx)("div",{className:`exclusions-wrapper ${l||g?"visible":"invisible"}`,children:(0,v.jsx)("h6",{style:{height:"30px",display:"flex",marginTop:"10px",paddingLeft:"3px",textAlign:"center"},children:(0,v.jsxs)("span",{children:[(0,v.jsx)("div",{children:"* Rewards may vary based on exchange rates."}),_?(0,v.jsxs)("div",{children:[" ","Terms and exclusions apply,",(0,v.jsxs)("span",{className:"tertiary-link-lighter",onClick:le,children:[" ","view details."]})]}):null]})})})]})]})}):null})},Yt=de({view:["cashbackView"],couponView:["couponView"],offers:["offers"],deweyResult:["deweyResult"],events:["events"],session:["session"],settings:["settings"],tld:["siteAPIData","siteData","tld"],hasActivatedCompetitor:["hasActivatedCompetitor"],warnAboutStandDown:["warnAboutStandDown"],couponsVisible:["couponsVisible"]},Lr);kt();var ra={cashback:"__wb_cns",sitehub:"__wb_sns"};function sa(e,t=60){let i=ra[e];if(!i)return console.error("[throttleNotification] Unknown notification type:",e),!1;let o=parseInt(localStorage.getItem(i))||0;return oi(new Date,new Date(o))>=t?(localStorage.setItem(i,String(+new Date)),!0):!1}function ca(e){let t=ra[e];if(!t){console.error("[clearThrottle] Unknown notification type:",e);return}localStorage.removeItem(t)}var G=c(C()),Sa=c(pi());di();var la="Cashback_Rewards";var rt=c(C());async function Br(e,t){let i=hi(e),o=await bi(i);if(!o)return null;let a=await Di();return{config:{rootEl:"div",logLevel:null},content:o,data:t,...a}}function pa(e,t){let[i,o]=(0,rt.useState)(null);return(0,rt.useEffect)(()=>{Br(e,t).then(a=>o(a)).catch(console.error)},[]),i}var va=c(ga());di();var Hr="Rewards",Wr="prefix",zr="prefix_lower",Kr="threshold_prefix",Yr="threshold_prefix_lower",Xr="up_to",Gr="up_to_lower",Qr="suffix",Jr="max_payout",Zr="suffix_threshold_condition";function wa(e,t,{capitalizePrefix:i=!0}={}){return e.type==="threshold"&&e.threshold?t(i?Kr:Yr):t(i?Wr:zr)}function ka(e,t,i,{capitalizeUpTo:o=!1,hideUpTo:a=!1}={}){var n,s;let r="";!a&&e.categories&&(r=t(o?Xr:Gr));let l=!((n=e.tiers)===null||n===void 0)&&n.length?e.tiers[e.tiers.length-1].reward.type:e.type,u=!((s=e.tiers)===null||s===void 0)&&s.length?e.tiers[e.tiers.length-1].reward.value:e.amount,g=l==="percentage"?`${u/100}%`:i(u),h="";if(e.maxPayoutAmount){let m=i(e.maxPayoutAmount);h+=t(Jr,{parseValues:{formattedMaxPayoutAmount:m}})}return r+g+h}function _a(e,t,i){var o;let a="";if(e.type==="threshold"&&e.threshold){let n=!((o=e.tiers)===null||o===void 0)&&o.length?e.tiers[e.tiers.length-1].spendCents:e.threshold,s=i(n);a=t(Zr,{parseValues:{formattedSpendThreshold:s}})}return t(Qr)+a}function jr(e,t,i,{capitalizePrefix:o=!0,capitalizeUpTo:a=!1,hideUpTo:n=!1}={}){let s=wa(e,t,{capitalizePrefix:o}),r=ka(e,t,i,{capitalizeUpTo:a,hideUpTo:n}),l=_a(e,t,i);return`${s}${r}${l}`}function ya(e){let{getValue:t}=qe(Hr),{formatCurrency:i}=_i(),o=l=>i(l,e);return{getFullDescription:l=>jr(l,t,o),getPrefix:(l,{capitalizePrefix:u=!0}={})=>wa(l,t,{capitalizePrefix:u}),getText:l=>ka(l,t,o),getSuffix:l=>_a(l,t,o)}}function xa(){let{cashbackView:e,couponView:t,events:i,settings:o,hasActivatedCompetitor:a,warnAboutStandDown:n,couponsVisible:s,throttleCreditsReactivation:r,userCountry:l,userCurrency:u}=(0,va.useBranch)({cashbackView:["cashbackView"],couponView:["couponView"],events:["events"],session:["session"],settings:["settings"],hasActivatedCompetitor:["hasActivatedCompetitor"],warnAboutStandDown:["warnAboutStandDown"],couponsVisible:["couponsVisible"],throttleCreditsReactivation:["throttleCreditsReactivation"],tld:["siteAPIData","siteData","tld"],userCountry:["session","country"],userCurrency:["siteAPIData","meta","currency"]}),{autoActivate:g,balance:h,exclusions:m,hasCoupons:R,id:U,isCashbackURLMatch:_,offerSignUp:E,qualified:k,reward:P,token:le,user:Q,vendor:$}=e,pe=l||"US",q=P?.currency??u,{getPrefix:pt,getText:Be,getSuffix:ut}=ya({country:pe,currency:q,truncateIntegers:!0}),dt=!!(Q&&Q.activated),ue=!!(Q&&Q.hasSeenFirst),{isQuietSavingsMiss:mt}=t,{eligibleForNewUserBonus:Me}=o,ei="hasSeenCashbackSignupTip"in i,A="hasSeenCashbackActivateTip"in i,{type:Oe,amount:Ta,categories:ft,threshold:Na,tiers:Ra}=P,Fe=Ra?.map(bt=>({...bt,spendCents:bt.spendCents||bt.spend_cents}))??[],Pa=!!(ft&&ft.length>0),Ia=Fe?.length>0?Fe[Fe.length-1].spendCents:Na,Ua=pt(P),La=Be(P),Ba=ut(P),{pageType:Ma,domain:ti}=e.deweyResult,Oa=_e(),Fa=oe(),ht=w(),$a=Ce(ht),qa=ht==="quill.com",Va=ne(ht),Ha=!$a,Wa=`${M}/s/${ti}/coupon`;return{allowNotification:Oa,warnAboutStandDown:n,hasSeenCashbackSignupTip:ei,hasSeenCashbackActivateTip:A,hasActivatedCompetitor:a,hasCategories:Pa,hasCoupons:R,isCashbackURLMatch:_,deweyDomain:ti,deweyPageType:Ma,offerSignUp:E,qualified:k,balance:h,vendorMetaId:U,exclusionDetailsLink:Wa,websiteExclusions:m,token:le,eligibleForNewUserBonus:Me,vendor:$,couponsVisible:s,isQuietSavingsMiss:mt,autoActivate:g,reward:P,rewardAmount:Ta,rewardType:Oe,rewardThreshold:Ia,rewardCategories:ft,rewardTiers:Fe,rewardPrefixText:Ua,rewardText:La,rewardSuffixText:Ba,useRedCta:Ha,activated:dt,isFullAccount:Fa,isQuillDomain:qa,isWayfairDomain:Va,throttleCreditsReactivation:r,userHasSeenFirst:ue}}var ce=c(d()),es="https://images.capitaloneshopping.com/api/v1/logos";function ts(e){let{getValue:t}=qe(la),i=xa(),{activated:o,allowNotification:a,hasCoupons:n,hasSeenCashbackActivateTip:s,hasSeenCashbackSignupTip:r,isCashbackURLMatch:l,isFullAccount:u,offerSignUp:g,reward:h,throttleCreditsReactivation:m,userHasSeenFirst:R,vendor:U,warnAboutStandDown:_}=i,E=pa("blocks-cashback-rewards"),[k,P]=(0,G.useState)(o),[le,Q]=(0,G.useState)(!1),[$,pe]=(0,G.useState)(!1),[q,pt]=(0,G.useState)(!1),[Be,ut]=(0,G.useState)(!1);(0,G.useEffect)(()=>{if($||k||!a)return;let A=t("cta_text");f("page","cashbackNotification",{view:"cashbackNotification",type:"notification",source:"cashback",deweyResult:i.deweyPageType,offerSignUp:i.offerSignUp,qualified:i.qualified,balance:i.balance,promotionalRate:void 0,vendorMetaId:i.vendorMetaId,token:i.token,ctaText:A,notificationText:""}),pe(!0)},[$,k]),(0,G.useEffect)(()=>{async function A(){!_||m||q||(await Ca(),pt(!0))}A()},[_,m,q]),(0,G.useEffect)(()=>{Be||a||(f("page","possibleExperience",{type:null,source:"credits",notificationText:"credits"}),ut(!0))},[Be,a]);let dt=async()=>(f("track","signinRequired",{vendor:U}),await Ke()?(P(!0),fe()):window.open(`${M}/sign-in`),Le()),ue=A=>{(A==="hasSeenCashbackSignupTip"&&!r||A==="hasSeenCashbackActivateTip"&&!s)&&Pe(A)},mt=async()=>{if(Q(!0),!u)return dt();ue("hasSeenCashbackActivateTip");let A=t("cta_text"),{isRedirectEnabled:Oe}=await ye({reward:h,label:A,pageLocation:void 0,view:void 0});setTimeout(()=>{Oe||fe(h),P(!0)},n?1500:5e3),Ae()},Me=A=>{(R||l)&&Xe(),P(!0),ue(g?"hasSeenCashbackSignupTip":"hasSeenCashbackActivateTip"),f("trackClick","dismissCashbackNotification",A,{rewardAmount:h.amount,rewardDisplay:h.type}),J("cashbackNotification",A,"dismiss","primary",{rewardAmount:h.amount,rewardDisplay:h.type})};return{blocksConfig:E,data:i,handleBlocksEvent:A=>{if(Si(A,e),A.type===_t.NotificationDismiss&&Me("Dismiss Notification"),A.type===_t.Custom)switch(A.eventName){case"activateReward":mt();break;case"dismiss":Me(t("dismiss_button_text"));break;default:break}},handleDismissTooltip:ue,hideNotification:k,isActivating:le,setIsActivating:Q,activated:o,hasSentPageNotification:$}}function ct({onUnload:e}){let{blocksConfig:t,data:i,handleBlocksEvent:o,handleDismissTooltip:a,hideNotification:n,isActivating:s,activated:r,hasSentPageNotification:l}=ts(e),{allowNotification:u,couponsVisible:g,hasSeenCashbackActivateTip:h,hasSeenCashbackSignupTip:m,isQuietSavingsMiss:R,autoActivate:U,offerSignUp:_,vendor:E}=i,k=Ne(`${es}?${Sa.default.stringify({domain:i.deweyDomain,width:300,height:300})}`);return!t||n||!u||g&&!R&&!U?null:(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(We,{client:He.DESKTOP_WEB,config:{...t.config,disableAnimation:l},content:t.content,host:t.host,user:t.user,data:{...i,isActivating:s,activated:r,logoImageUri:k},onEvent:o}),(0,ce.jsx)(Re,{offerSignUp:_,storeName:E,hideNotification:n,onDismissTooltip:a,hasSeenCashbackSignupTip:m,hasSeenCashbackActivateTip:h})]})}var lt=c(d());function is(){return p.get("hasActivatedCompetitor")||p.get("warnAboutStandDown")}function os(){return nt(w())?!1:S("should_use_blocks_service")&&S("ext_blocks_cashback_rewards_switch")}var Ea;function as(){Ea?.()}async function se(e="cashback"){let t;e==="reactivate"?t=(0,lt.jsx)(Yt,{}):os()?t=(0,lt.jsx)(ct,{onUnload:as}):t=(0,lt.jsx)(zt,{}),Ea=(await ze({appName:e,cssUrl:"cashback.css",app:t})).unload,p.set("cashbackVisible",!0),e==="reactivate"&&(yi("cashback"),p.set("cashbackReactivateVisible",!0))}var ns={devRewardTest:!1};async function rs(e,t){let{devRewardTest:i=!1}=t??ns,o=p.get("cashback"),a=is()&&B.default.get(o,"user.compInactivated");if((Ui()||Li())&&!a){Mi();return}let n=Da.default.getDomain(location.href);if(n?.match(/hilton\.com/)&&S("cb_hilton_honors"))return;let s=n&&ci(n)&&S("expedia_extension_testing_q2_2025"),r=!1,l=["cartPage","checkoutPage","reviewPage"],{siteData:u,meta:g}=p.get("siteAPIData")||await xi(),h=u.cashback?.pageTypeOverrides||B.default.get(u.cashback,"pageTypesOverride",{})||{},m=B.default.get(e,"pageType");if(h&&h[m]){let _=h[m],E=B.default.get(_,"value",_),k;if(E==="show"?r=!0:E==="hide"?r=!1:E==="conditional"&&_.conditional&&(k=ss(_.conditional),!k||k.type==="hide"&&k.hide?r=!1:r=!0),f("track","cashbackNotificationOverride",{show:r,reason:B.default.get(k,"feature","")}),!r)return}else if(s&&!["cartPage","checkoutPage","confirmationPage"].includes(m))sa("cashback")&&(r=!0,ca("sitehub"));else if(a)r=!0;else if(l){if(r=l.indexOf(m)!==-1,a&&(r=!0),o&&(B.default.get(o,"user.activated")||a)&&!r&&!B.default.get(o,"user.dismissed")&&!p.get("cashbackVisible")&&!p.get("couponsVisible")&&!p.get("cashbackReactivateVisible")&&!p.get("throttleCreditsReactivation")){await se("reactivate");return}}else m=B.default.snakeCase(m),r=new Set(u.cashback.minNotificationsPageTypes).has(m);if(i&&(r=!0),!r){let _=Object.keys(u.pageTypesV2||{}),E=_.includes("cartPage"),k=_.includes("checkoutPage");(!E&&new RegExp(/^\/cart(?![\w-~!$&'()*+,;=:@%])/i).test(location.pathname)||!k&&new RegExp(/^\/checkout(?![\w-~!$&'()*+,;=:@%])/i).test(location.pathname))&&(r=!0)}let R=s?o?.user?.dismissed&&o?.user?.dismissedPageType==="checkoutPage":o?.user?.dismissed;if(!o||!r||R||p.get("cashbackVisible")||p.get("cashbackReactivateVisible"))return;if(Bi()){Oi();return}let U=p.get("cashbackView")||o;if(p.set("cashbackView",{...U,isCashbackURLMatch:!0,deweyResult:e,ebatesReward:u.ebatesReward,exclusions:B.default.get(u,"merchantPage.exclusions"),affiliateLinkCurrentTab:B.default.get(g,"affiliate_link_current_tab")}),a&&!B.default.get(o,"user.activated")&&!p.get("couponsVisible")&&!p.get("throttleCreditsReactivation")){p.set(["warnAboutStandDown"],!0),await se("reactivate");return}await se()}function ss(e){try{let t=JSON.parse(e),i=B.default.map(t.hide,s=>({hide:S(s),feature:s,type:"hide"})),o=B.default.map(t.show,s=>({show:S(s),feature:s,type:"show"})),a=B.default.find(i,{hide:!0}),n=B.default.find(o,{show:!0});return a||n||!1}catch{return!1}}var Aa=e=>N("checkIfInPriceComparison",e);var cs=new Set(["ebay.com","stubhub.com","stubhub.ca"]);async function Zt(e){if(cs.has(e))return Aa(e)}async function Ue(e=!1){let t=!1,i=await $i(e);return(i&&Z.default.get(i,"reward.amount")||e&&i?.hasDeferredProgramSelection)&&(t=i),t}async function Ca(){let e=await Ue();p.merge({cashback:e}),await se("reactivate")}function Pe(e){let t={[e]:Date.now()},i=Z.default.cloneDeep(p.get(["events"]));i=Z.default.merge(i,t),p.set(["events"],i),Fi(e)}async function na(e){let t={rakuten:"rakuten",honey:"honey",rmn:"rmn"},i=await Ye(t.honey),o=await Ye(t.rakuten),a=await Ye(t.rmn),n="";i&&(n="honey"),a&&(n="rmn"),o&&(n="rakuten"),chrome.storage.local.set({[`${n}WarningNotif-${e}`]:$e()},()=>{o&&De(t.rakuten),i&&De(t.honey),a&&De(t.rmn),n===""&&De(n)})}async function Le({clickId:e,coupons:t,codeEntered:i,autoSavings:o=!1,fromAutoRun:a,fromActivateRewards:n,isSiteHub:s}={}){let r=w();p.set(["couponsAffiliateDisabledSites",`${r}_${p.get("tabId")}`],wt(gt(new Date,30)));let l=e||jt.default.v4().replace(/-/g,""),u=await Ct({pageViewId:p.get("pageViewId"),clickId:l,domain:r,coupons:t,codeEntered:i,programId:p.get(["siteAPIData","programId"]),vendorMetaId:p.get("cashback","id"),token:p.get("cashback","token"),fromAutoRun:a,autoSavings:o,fromActivateRewards:n,isSiteHub:s});return t&&u?.tripId&&p.set(["couponView","tripId"],u.tripId),u}async function ls(){let e=w();await Promise.all([St("affiliateRedirect",JSON.stringify({redirected:!0,location:location.href})),St("emailCreateAccount",JSON.stringify({shouldLoadNotification:!0}))]),p.set(["couponsAffiliateDisabledSites",`${e}_${p.get("tabId")}`],wt(gt(new Date,30)));let t=jt.default.v4().replace(/-/g,""),i,o="cashback",a=await Zt(e);a&&(o="cashback-ims");let n={destUrl:location.href,channel:o,subExperience:"credits",redirectId:ui(t),sameTab:!0,vendorMetaId:p.get("cashback","id"),token:p.get("cashback","token"),clickEvent:"cashbackRedirect",...!a&&{destDomain:p.get("siteAPIData","tld")}},s=p.get("cashback","redirectUrl");s?i=li(s,{subExperience:n.subExperience,redirectId:n.redirectId,clickEvent:n.clickEvent}):i=vi({params:n});let r={affiliateUrl:i,pageViewId:p.get("pageViewId"),clickId:t,domain:e,preventPinnedTab:!0,vendorMetaId:p.get("cashback","id"),token:p.get("cashback","token"),programId:p.get(["siteAPIData","programId"])};return Ct(r),r}async function ye({reward:e,pageLocation:t,view:i,label:o}={}){f("trackClick","activateCashback","activate",{rewardAmount:e.amount,rewardDisplay:e.type,label:o,view:i,pageLocation:t}),J(t==="sitehub"?"siteHubOffers":i==="cashbackReactivate"?"rewardsReactivation":"cashbackNotification",o,"cta","primary",{redirect:!0,cashback:!!e.amount,rewardAmount:e.amount,rewardDisplay:e.type,view:i});let a=p.get(["siteAPIData"]),n=p.get(["deweyResult"]),s=Z.default.get(n,"pageData.meta"),r=!0;if(s&&Z.default.has(s,"disable_aff_link_current_tab")&&(r=!1),r&&Z.default.get(a,"meta.affiliate_link_current_tab")){let u=await ls();return f("track","activateCashbackRedirect",Z.default.assign({rewardAmount:e.amount,rewardDisplay:e.type,view:i},u)),location.href=u.affiliateUrl,{isRedirectEnabled:!0}}p.set(["cashbackView","user","activating"],!0),p.set(["cashback","user","activating"],!0),p.set(["offers","cashback","user","activating"],!0);let l=await Le();return p.set(["cashbackView","user","activated"],!0),p.set(["cashback","user","activated"],!0),p.set(["offers","cashback","user","activated"],!0),f("track","activateCashbackRedirect",Z.default.assign({rewardAmount:e.amount,rewardDisplay:e.type,view:i},l)),{isRedirectEnabled:!1}}function _e(){let e=!0;if(S("ext_ae_api_v_2")){let t=p.get(["couponView","elasticityUserDomain"]);t&&!t?.i&&(e=t.s)}return!!e}export{Ui as a,Li as b,Bi as c,Mi as d,Oi as e,St as f,J as g,Zt as h,Ue as i,Pe as j,Le as k,ls as l,ye as m,Vi as n,Ae as o,Tt as p,Nt as q,Pt as r,Ut as s,je as t,Lt as u,ne as v,Bt as w,ge as x,En as y,An as z,Tn as A,et as B,Yt as C,sa as D,is as E,se as F,rs as G};
/*! Bundled license information:

exenv/index.js:
  (*!
    Copyright (c) 2015 Jed Watson.
    Based on code that is Copyright 2013-2015, Facebook, Inc.
    All rights reserved.
  *)
*/
