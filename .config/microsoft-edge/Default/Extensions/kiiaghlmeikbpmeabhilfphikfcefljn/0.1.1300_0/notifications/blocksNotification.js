import{b as Z,d as _,e as te,f as w,g as x}from"../chunks/chunk-GQ2ZFDTT.js";import{b as j}from"../chunks/chunk-ZMUT3H36.js";import{i as $}from"../chunks/chunk-JMZ6COH5.js";import{b as k}from"../chunks/chunk-TL3QIPOO.js";import{a as J}from"../chunks/chunk-5JMRRCOD.js";import"../chunks/chunk-LZ4BOSIO.js";import"../chunks/chunk-UWSVS74H.js";import"../chunks/chunk-UK623MXR.js";import"../chunks/chunk-DB2INE3Z.js";import"../chunks/chunk-5DIWEA5K.js";import{b as z,c as A,d as Q,e as b}from"../chunks/chunk-C3OCDYXE.js";import"../chunks/chunk-2R34RLZD.js";import{a as X}from"../chunks/chunk-VMXEY2MG.js";import{a as ee}from"../chunks/chunk-VQDKWH7E.js";import"../chunks/chunk-JWRT5PWI.js";import{a as P,b as L,d as u,e as f,f as M}from"../chunks/chunk-XNQV75SS.js";import"../chunks/chunk-JDV5FZKX.js";import"../chunks/chunk-35WHJZQO.js";import"../chunks/chunk-NUCLT2FJ.js";import"../chunks/chunk-2IU7RY3W.js";import{a as q,b as W,c as R}from"../chunks/chunk-542QW3ZK.js";import"../chunks/chunk-IYAFYZRF.js";import{a as v,b as S,e as D}from"../chunks/chunk-JNO5G2QC.js";import"../chunks/chunk-ZRXJBILZ.js";import"../chunks/chunk-F2BE3OL5.js";import"../chunks/chunk-AZABECDO.js";import"../chunks/chunk-AJE3NLZ4.js";import"../chunks/chunk-TOX56BBT.js";import"../chunks/chunk-TYA5STFG.js";import"../chunks/chunk-KWORSN6K.js";import{e as g,f as V,p as Y}from"../chunks/chunk-TXXCCNWI.js";import"../chunks/chunk-O4TFJKJQ.js";import{m as r,o as T,p as y,s as n,t as p,w as H}from"../chunks/chunk-CHZKSFGE.js";import"../chunks/chunk-Z4H6U7OH.js";import"../chunks/chunk-LIVBINA3.js";import"../chunks/chunk-HQ4MM2EX.js";import"../chunks/chunk-4TYY7CF3.js";import"../chunks/chunk-VCHBXYSK.js";import"../chunks/chunk-ZIVQ3XHH.js";import"../chunks/chunk-JDJMGFXU.js";import{z as G}from"../chunks/chunk-T5WNPH4X.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import{a as F,c as ge}from"../chunks/chunk-IUWVXOWN.js";import{c as K}from"../chunks/chunk-HPNQXUCM.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-KUOYBGP4.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-KSIO6WHA.js";import"../chunks/chunk-BETA3R27.js";import{e as m}from"../chunks/chunk-3GYLW4KZ.js";var C=m(G());M();var ae=m(g()),ke=async()=>{let t=W("postcheckout-email-create-account-block-notification"),e=await R(t),s={rootEl:"div",logLevel:null},o=await b(),a={merchantName:o.host.merchant??""};return{config:s,content:e,data:a,...o}},re=({onUnload:t})=>{let[e,s]=(0,C.useState)(),o=(0,C.useCallback)(async a=>{switch(a.type){case S.Destroy:t?.(),r.set(f.treeVisible,!1);break;case S.NotificationShow:p("track",f.metric,{action:"seen"});break;case S.NotificationDismiss:await k({message:P.dismiss}),p("track",f.metric,{action:"dismissed"}),r.set(f.treeVisible,!1);break;case S.Custom:a.eventName==="onCreateAccountClick"?(await k({message:P.clickedCreateAccount}),p("track",f.metric,{action:"clicked"})):a.eventName==="onSignInClick"&&(await k({message:P.clickedSignIn}),p("track",f.metric,{action:"signIn"})),r.set(f.treeVisible,!1),t?.();break}},[t]);return(0,C.useEffect)(()=>{ke().then(a=>{s(a),r.set(f.treeVisible,!0)}).catch(console.error)},[]),e?(0,ae.jsx)(D,{client:v.DESKTOP_WEB,config:e.config,content:e.content,data:e.data,user:e.user,onEvent:o,onRequest:A}):null};var N=m(G()),E=m(K());var se=t=>H("getReferralsOfferData",t);var ne=m(g());async function Ce(){let[t,e,s,o]=await Promise.all([ee(),X(),$(),se()]);t&&(r.set("pageViewId",window.__wb_page_view_id),r.set("session",E.default.get(t,"session")),r.set("events",E.default.get(t,"settings.events")),r.set("settings",E.default.get(t,"settings")),r.set("tabId",E.default.get(t,"tabId")),r.set("lexiFetchResponse",E.default.get(t,"lexiFetchResponse"))),r.merge({siteAPIData:e}),r.merge({cashback:s}),r.set("referralsOffer",o)}async function Ee(){await Ce();let t=r.get("siteAPIData"),e=t?.siteData?.cashback?.reward||{},s=await chrome.storage.local.get("lastCouponSavings"),o=s?.lastCouponSavings,a=r.get("cashback"),i=r.get("referralsOffer"),d=q("post-checkout-referrals"),l=n("should_use_blocks_service")&&d?await R(d):void 0,U=l||await j("desktopextension-postcheckout-referrals"),de={rootEl:"div",logLevel:null},pe={senderBonus:i.senderBonus||0,maxReferralValue:i.maxReferralValue||0,referralLink:i.code?`${V}/${i.code}`:null,$savings:{couponSavings:o??0,cashbackActivated:!!a?.user?.activated,couponsActivated:o!=null},siteReward:e,couponSavings:s?.lastCouponSavings||0,throttleKey:"postcheckout_modal_referrals"},he=await b();return{config:de,content:U,data:pe,...he}}function B({onUnload:t}){let[e,s]=(0,N.useState)();return(0,N.useEffect)(()=>{Ee().then(o=>s(o)).catch(console.error)},[]),e?(0,ne.jsx)(D,{client:v.DESKTOP_WEB,config:e.config,content:e.content,host:e.host,user:e.user,data:e.data,onEvent:o=>{o.type==="sp-blocks-custom"&&o.eventName==="clickCopyLink"&&navigator.permissions.query({name:"clipboard-write"}).then(a=>{(a.state==="granted"||a.state==="prompt")&&e.data&&!(e.data instanceof Map)&&navigator.clipboard.writeText(e.data.referralLink)}),z(o,t)},onRequest:A}):null}var ce=m(K());ge();M();async function Te(){let t=await k({message:"getEvents"}),e=ce.default.chain(t).pickBy(l=>new Date().valueOf()-new Date(l).valueOf()<2592e6).value(),s=u.clickedSignIn in e&&new Date().valueOf()-new Date(e[u.clickedSignIn]).valueOf()<864e5;if(u.clickedSignUp in e&&new Date().valueOf()-new Date(e[u.clickedSignUp]).valueOf()<864e5||s)return!0;let a=u.seenPostCheckoutCreateAccount1 in e&&u.seenPostCheckoutCreateAccount2 in e&&u.seenPostCheckoutCreateAccount3 in e,i=new Date(Math.max(new Date(e[u.seenPostCheckoutCreateAccount1]||0).valueOf(),new Date(e[u.seenPostCheckoutCreateAccount2]||0).valueOf(),new Date(e[u.seenPostCheckoutCreateAccount3]||0).valueOf())),d=i&&new Date().valueOf()-i.valueOf()<864e5;return!!(a||d)}async function ie(){F("*** postCheckoutCreateAccount: evaluating...");let t=r.get(f.treeVisible);return J()||t||await Te()?!1:T(L.enabled)}var c=m(g());window.__wb_timing.blocksNotifRequireAt=performance.now();var ue;function O(){ue?.()}function h(){we(),O()}var Se="blocks_cross_device",Pe={throttleKey:Se},Re=["postcheckout_modal_dtm_xd_switch_","postcheckout_modal_dtm_xd_retarget_switch_"];function ve(){return Re.some(T)}var De=new Set(["walmart.com"]);function Ae({createAccountThrottled:t,referralsThrottled:e,xSellThrottled:s,retargetingThrottled:o}){let a=r.get("siteAPIData"),i=a?.tld||"",d=a?.siteData?.cashback?.reward||{amount:0};if(!t)return(0,c.jsx)(re,{onUnload:O});if(d.amount===0&&!o&&!De.has(i)){let l=n("ext_post_checkout_fallback_deals");if(n("ext_pcm_thresh_test_1"))return(0,c.jsx)(_,{blocksSlug:"post-checkout-single-recommended-offer",providedData:{throttleKey:"post-checkout-single-recommended-offer"},onUnload:h,contentProps:{type:"threshold"}});if(n("ext_pcm_retargeting"))return(0,c.jsx)(_,{blocksSlug:"post-checkout-retargeting",providedData:{throttleKey:"post-checkout-retargeting"},onUnload:h,contentProps:{type:"deals",fillWithFallback:l}});if(n("ext_pcm_retargeting_product"))return(0,c.jsx)(_,{blocksSlug:"post-checkout-retargeting-products",providedData:{throttleKey:"post-checkout-retargeting-products"},onUnload:h,contentProps:{type:"products",fillWithFallback:l}});if(n("ext_pcm_retargeting_multi"))return(0,c.jsx)(_,{blocksSlug:"post-checkout-retargeting-multi",providedData:{throttleKey:"post-checkout-retargeting-multi"},onUnload:h,contentProps:{type:"multi",fillWithFallback:l}});if(n("ext_post_checkout_non_vm_feed_cta"))return(0,c.jsx)(_,{blocksSlug:"post-checkout-retargeting-single_offer",providedData:{throttleKey:"post-checkout-retargeting-single_offer"},onUnload:h,contentProps:{type:"deals",fillWithFallback:l}});if(n("ext_post_checkout_deals_non_vm_a"))return(0,c.jsx)(x,{contentSlug:"post-checkout-deals-non-vm",blocksSlug:"post-checkout-deals-non-vm",providedData:{scopeName:"Post_Checkout_Deals_Non_VM",source:"postCheckoutRetargeting",viewSource:"feed_cta_offer"},onUnload:O,includeTopDeals:!0});if(n("ext_post_checkout_recommended_offers"))return(0,c.jsx)(_,{blocksSlug:"post-checkout-recommended-offers",providedData:{throttleKey:"post-checkout-recommended-offers"},onUnload:h,contentProps:{type:"recommended"}});if(n("ext_post_checkout_recommended_offers_single_cta"))return(0,c.jsx)(_,{blocksSlug:"post-checkout-single-recommended-offer",providedData:{throttleKey:"post-checkout-single-recommended-offer"},onUnload:h,contentProps:{type:"deals"}})}return!s&&ve()?(0,c.jsx)(x,{contentSlug:"blocks-notification",blocksSlug:"blocks-notification",onUnload:O,providedData:Pe,includeTopDeals:!0}):n("desktopextension_postcheckout_referrals")&&T("postcheckout_modal_desktop_ref_switch_")&&!e?(0,c.jsx)(B,{onUnload:O}):null}var fe=60*1e3,be=60*fe,me=24*be,_e="postcheckout_modal_retargeting";function we(){te(_e)}function Ne(){return y("postcheckout_modal_dtm_xd_06242025_",30*24*60)*fe}function Be(){return y("desktop_ext_pcm_referrals_throttle_days_",7)*me}async function Ue(){O(),await ye();let t=await ie(),[e,s,o]=await Promise.all([w(Be(),"postcheckout_modal_referrals"),w(Ne(),"blocks_cross_device_throttle"),w(2*me,_e)]);ue=(await Y({appName:"blocksNotification",blankSlate:!0,app:(0,c.jsx)(Ae,{createAccountThrottled:!t,referralsThrottled:e,xSellThrottled:s,retargetingThrottled:o})})).unloadApp}async function ye(){if(n("ext_check_pcm_available_offers")){let t=await Z(["products","deals","multi","recommended","threshold"]),e=t.products?.length||0,s=t.deals?.length||0,o=t.multi?.length||0,a=t.recommended?.length||0,i=t.threshold?.length||0,l=e>0||s>0||o>0||a>0||i>0?"offers_available":"no_offers_available",U=JSON.stringify({offers:{productRetargeting:e,nonProductRetargeting:s,multiRetargeting:o,recommendedRetargeting:a,thresholdRetargeting:i}});p("page","postCheckoutNotification",{view:l,meta:U})}}async function le(){try{let t=n("ext_debug_blocks_notifs"),e=(await Q())?.pageType;if(!(t||e==="confirmationPage"))return;await Ue()}catch(t){console.error(t)}}document.readyState!=="loading"?le():document.addEventListener("DOMContentLoaded",le);export{Be as getPCMReferralsThrottleDuration};
