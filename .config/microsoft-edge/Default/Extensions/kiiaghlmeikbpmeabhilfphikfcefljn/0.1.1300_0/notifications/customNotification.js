import{C as _,o as O}from"../chunks/chunk-HDCG35CA.js";import"../chunks/chunk-QQFNG2AW.js";import"../chunks/chunk-QTFDT3SV.js";import"../chunks/chunk-OOVGOOFN.js";import"../chunks/chunk-JMZ6COH5.js";import"../chunks/chunk-TL3QIPOO.js";import"../chunks/chunk-5JMRRCOD.js";import"../chunks/chunk-IDR6MOLX.js";import"../chunks/chunk-J5F3A7TB.js";import{c as L}from"../chunks/chunk-LZ4BOSIO.js";import"../chunks/chunk-UWSVS74H.js";import{a as D,b as q}from"../chunks/chunk-UK623MXR.js";import"../chunks/chunk-5DIWEA5K.js";import"../chunks/chunk-C3OCDYXE.js";import"../chunks/chunk-2R34RLZD.js";import{a as S}from"../chunks/chunk-VMXEY2MG.js";import"../chunks/chunk-JWRT5PWI.js";import"../chunks/chunk-XNQV75SS.js";import"../chunks/chunk-JDV5FZKX.js";import"../chunks/chunk-BCG2KUGW.js";import"../chunks/chunk-35WHJZQO.js";import{a as C}from"../chunks/chunk-NUCLT2FJ.js";import"../chunks/chunk-2IU7RY3W.js";import"../chunks/chunk-542QW3ZK.js";import"../chunks/chunk-IYAFYZRF.js";import"../chunks/chunk-JNO5G2QC.js";import"../chunks/chunk-ZRXJBILZ.js";import"../chunks/chunk-F2BE3OL5.js";import{a as x}from"../chunks/chunk-AZABECDO.js";import"../chunks/chunk-AJE3NLZ4.js";import{a as F}from"../chunks/chunk-TOX56BBT.js";import"../chunks/chunk-TYA5STFG.js";import{a as N}from"../chunks/chunk-KWORSN6K.js";import{c as k,e as m,p as v}from"../chunks/chunk-TXXCCNWI.js";import{a as H}from"../chunks/chunk-O4TFJKJQ.js";import{m as y,t as p,w as f}from"../chunks/chunk-CHZKSFGE.js";import{a as b,b as W}from"../chunks/chunk-PVPCVBPO.js";import"../chunks/chunk-Z4H6U7OH.js";import"../chunks/chunk-LIVBINA3.js";import"../chunks/chunk-HQ4MM2EX.js";import"../chunks/chunk-4TYY7CF3.js";import"../chunks/chunk-VCHBXYSK.js";import"../chunks/chunk-ZIVQ3XHH.js";import"../chunks/chunk-JDJMGFXU.js";import{z as $}from"../chunks/chunk-T5WNPH4X.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import"../chunks/chunk-IUWVXOWN.js";import{c as w}from"../chunks/chunk-HPNQXUCM.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-KUOYBGP4.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-KSIO6WHA.js";import"../chunks/chunk-BETA3R27.js";import{e as s}from"../chunks/chunk-3GYLW4KZ.js";var A=s(H()),c=s(w());var P=()=>f("getCustomNotification");var U=s($()),u=s(F()),r=s(w());W();var M=t=>f("engageCustomNotification",t);function g(){M()}var e=s(m()),h=class extends U.Component{constructor(...i){super(...i);let o,n=r.default.get(r.default.find(this.props.customNotificationData,"displaySequence"),"displaySequence",[]);n.length?o=n[0]:o=this.props.customNotificationData[0].display,this.state={rightOffset:310,notification:0,hideNotification:!0,dismiss:!1,progress:!1,displaySequence:n,...o}}componentDidMount(){p("page","customNotification",{view:"customNotification",type:"notification",offerSignUp:r.default.get(this.props.view,"offerSignUp"),qualified:r.default.get(this.props.view,"qualified",!1),balance:r.default.get(this.props.view,"balance",0)}),setTimeout(()=>{document.querySelector("#honeyContainer")&&this.setState({compNotifLoaded:!0,rightOffset:"300px"}),(document.querySelector(".ebates-notification")||document.querySelector(".ebates-hover.ebates-hover-top"))&&this.setState({compNotifLoaded:!0,rightOffset:"410px"}),this.setState({hideNotification:!1})},500)}render(){let{hideNotification:i,rightOffset:o}=this.state,n=!0,a=!0,l;return this.state.cta&&(l=(0,e.jsx)("div",{className:"button-wrapper",children:(0,e.jsx)("button",{className:"primary-btn-large",onClick:this.onClick.bind(this),children:this.state.cta})})),(0,e.jsx)(D,{className:i?"disabled follow-page":"follow-page",style:{top:n?"0":"auto",bottom:n?"auto":"0",left:a?"auto":"0",right:o},dragSelector:"header",onDragEnd:this.trackFirstDragEnd,children:(0,e.jsx)(u.Motion,{style:{opacity:(0,u.spring)(i?0:1,{stiffness:180,damping:20}),y:(0,u.spring)(i?n?-100:100:0,{stiffness:180,damping:20})},children:({opacity:I,y:R})=>(0,e.jsxs)("div",{className:"custom-notification",style:{transform:`translate3d(0,${R}%,0)`,opacity:`${I}`},children:[(0,e.jsxs)("header",{children:[(0,e.jsx)(N,{width:120}),(0,e.jsx)(L,{}),(0,e.jsx)(x,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,e.jsxs)("section",{children:[(0,e.jsx)("h2",{children:this.state.title}),this.state.progress?(0,e.jsx)(_,{estimatedDuration:5e3}):null,this.state.subtitle?(0,e.jsx)("h4",{className:"bold",children:this.state.subtitle}):null,l]})]})})})}trackFirstDragEnd=r.default.once((i,o)=>{q("customNotification",i,o)});onClick(){let{clickId:i,redirectId:o}=b();if(this.state.dropCookie&&O(i),this.state.sendMetric&&p("track","noCouponsNotify",{clickId:i,currentLocation:r.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}),this.state.notification<this.state.displaySequence.length-1){let n=this.state.notification+1,a=this.state.displaySequence[n],l=()=>{this.setState({notification:n,...a}),this.state.timeout&&a.timeout===void 0&&this.setState({timeout:void 0}),n===this.state.displaySequence.length-1&&a.timeout&&setTimeout(()=>{this.onClosePopup()},this.state.timeout)};this.setState({progress:!!this.state.timeout}),setTimeout(()=>{l(),this.setState({progress:!1})},this.state.timeout*2||0)}else if(this.props.customNotificationData.url){g();let n={destUrl:this.props.customNotificationData.url,redirectId:o},a=C({params:n});window.open(a,"_blank"),p("trackClick","customNotificationClick","",{view:"customNotification",pageLocation:"notification",clickId:i})}else setTimeout(()=>{this.onClosePopup()},this.state.timeout||0)}onClosePopup(i){g(),this.setState({hideNotification:!0}),p("trackClick","dismissCustomNotification",i)}},d=k({view:["customView"],customNotificationData:["customNotificationData"],events:["events"],session:["session"]},h);var E=s(m());function T(t){if(t.type==="url")return!!document.URL.match(t.value);if(t.type==="title")return document.title.match(t.value);if(t.type==="selector")return!!(0,A.default)(t.value).length}function V(t){if(t.and)return(0,c.default)(t.and).map(o=>T(o)).filter().value().length===t.and.length;if(t.or)return!!(0,c.default)(t.or).map(o=>T(o)).filter().value().length}function j(t){return c.default.find(t,i=>V(i.identifiers))}function B(t,i){if(c.default.has(i,"runWithCoupons")){let o=!c.default.get(t,"coupons.ignoreSite");return!!(o&&i.runWithCoupons!==!1||!o)}return!0}async function z(){try{let t=await P();if(t&&t.engaged)return!1;let{siteData:i}=await S(),o=c.default.filter(i.notifications,a=>a.enabled!==!1&&B(i,a));j(o)&&o.length&&(y.set("customNotificationData",o),v({appName:"customNotification",cssUrl:"customNotification.css",app:(0,E.jsx)(d,{})}))}catch{}}document.readyState!=="loading"?z():document.addEventListener("DOMContentLoaded",z);
