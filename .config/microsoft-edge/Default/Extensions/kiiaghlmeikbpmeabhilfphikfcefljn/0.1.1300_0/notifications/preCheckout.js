import{a as N}from"../chunks/chunk-RDQO4EI3.js";import{a as ge}from"../chunks/chunk-5JMRRCOD.js";import{a as Q}from"../chunks/chunk-25CN3A5B.js";import"../chunks/chunk-ZRXJBILZ.js";import"../chunks/chunk-F2BE3OL5.js";import{b as I,c as Z,e as Ce,f as Te,g as Pe,h as Re,i as F,s as he,t as Oe,u as xe,v as Se}from"../chunks/chunk-AJE3NLZ4.js";import{a as fe}from"../chunks/chunk-KWORSN6K.js";import{e as p,g as Ee,m as G,p as y}from"../chunks/chunk-TXXCCNWI.js";import"../chunks/chunk-O4TFJKJQ.js";import{m as me,p as B,s as k,t as b,w as S}from"../chunks/chunk-CHZKSFGE.js";import"../chunks/chunk-JLZNCAMO.js";import{c as le,d as pe,e as Ct,p as ue,q as Tt,t as Pt}from"../chunks/chunk-LIVBINA3.js";import"../chunks/chunk-VCHBXYSK.js";import"../chunks/chunk-JDJMGFXU.js";import{E as P,F as v,z as M}from"../chunks/chunk-T5WNPH4X.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import{a as g,c as _e}from"../chunks/chunk-IUWVXOWN.js";import{d as Rt}from"../chunks/chunk-HPNQXUCM.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-KUOYBGP4.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-KSIO6WHA.js";import"../chunks/chunk-BETA3R27.js";import{e as c}from"../chunks/chunk-3GYLW4KZ.js";Tt();var ct=c(Rt());_e();var ke=t=>S("getPreCheckoutDismissThrottle",t);var be=t=>S("getPreCheckoutOffers",t);var Ie=(t,e)=>S("setRewardTokenCookie",{domain:t,token:e});var Qe=c(M());v();var ye="ext_prcs_send_results",Ne="ext_prcs_card_inject_display",Le="ext_prcs_ern_prompt",Ue="ext_prcs_trn_prompt",Ae="ext_prcs_multi_prompt",j="ext_prcs_dismiss_throttle_";var De="#bGmlqc",ve=".YNk70c.CuvrIe>.UFQ0Gb",V=".top-pla-group-inner .pla-unit",we=".GUyUUb",He="g-scrolling-carousel",Ke="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",Me="__WBCLICKID__",L="prcsClick",U={HOLDOUT:"injected_holdout",INJECTED_BUTTON:"injected_button",EMBEDDED_RIGHT:"injected_ern",TOP_RIGHT_OVERLAY:"injected_trn",EMBEDDED_MULTI_OFFER:"embedded_multi_offer"},Be="missing_images",Fe="button_cta",Ge="Results with Rewards",Ye="button_dismiss",je="x",Y="product_click",Ve="oc_inj_product_click",We="base_product_click",ht="ern_cta",Ot="Results with Rewards",xt="ern_dismiss",St="x",gt="ern_product_click",kt="trn_cta",bt="Results with Rewards",It="trn_dismiss",yt="x",Nt="trn_product_click",Je="mo_cta";var qe="mo_dismiss",Xe="x",$e="mo_product_click",ze="mo_no_offers",R={BUTTON_TOOLBAR:"Pre_Checkout_SponsoredProduct_Button_Toolbar",EMBEDDED_RIGHT:"Pre_Checkout_SponsoredProduct_Embedded_Right_Notification",TOP_RIGHT:"Pre_Checkout_SponsoredProduct_Top_Right_Notification",MULTI_OFFER:"Pre_Checkout_SponsoredProduct_Multi_Offer"},W={ern:{componentName:"ern",ctaEventType:ht,ctaEventLabel:Ot,dismissEventType:xt,dismissEventLabel:St,productClickEventType:Y,productClickEventSubType:gt},trn:{componentName:"trn",ctaEventType:kt,ctaEventLabel:bt,dismissEventType:It,dismissEventLabel:yt,productClickEventType:Y,productClickEventSubType:Nt}};var _=c(p());function J({onShowProductAnnotations:t,onHideProductAnnotations:e}){let[o,n]=(0,Qe.useState)(!1),{getValue:r}=P(R.BUTTON_TOOLBAR),s=`${Ee}/our-terms/terms-of-service`,m=()=>{o?e&&e():t&&t(),n(!o)};return(0,_.jsxs)("div",{className:"pre-checkout-button flex flex-row justify-start items-center mt-0 mr-0 mb-2 ml-0",children:[(0,_.jsx)("img",{className:"logo h-[30px]",src:r("logo")}),(0,_.jsx)("div",{children:(0,_.jsx)(he,{children:(0,_.jsxs)(Oe,{delayDuration:150,children:[(0,_.jsxs)(xe,{className:"tooltip-trigger border-none outline-none shadow-none m-0 pt-1 pr-3 pb-1 pb-0 text-medium-gray font-light italic text-neutralsecondary min-w-0",children:[r("tooltip_trigger")," ",(0,_.jsx)(Z,{className:"info-icon h-[16px] w-[16px] pl-1"})]}),(0,_.jsxs)(Se,{side:"right",sideOffset:20,className:"tooltip-content font-light italic text-neutralsecondary w-[400px] ",children:[(0,_.jsx)(Z,{className:"info-icon h-[16px] w-[16px]"})," ",r("tooltip_content")," ",(0,_.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:"Terms Apply"})]})]})})}),(0,_.jsx)("div",{children:(0,_.jsxs)(F,{className:o?"rewards-button active text-green-550 font-bold border-rounded-lg mt-[2px] hover:text-green-650 border-none bg-green-50 hover:bg-green-50":"rewards-button inactive text-green-550 font-bold border-rounded-lg mt-[2px] hover:text-green-650 bg-white hover:bg-white border-green-550 hover:border-green-550",variant:"link",onClick:m,children:[" ",o&&(0,_.jsx)(I,{className:"w-6 h-6 pr-2"}),r("rewards_button_text")]})})]})}v();var w=c(p());function ee({displayReward:t,rewardHasPrefix:e=!1,enabled:o}){let{getValue:n}=P(R.BUTTON_TOOLBAR,{defaultValues:{displayReward:t}}),r=n(e?"prefixed_rewards_text":"rewards_text");return o?(0,w.jsxs)("div",{className:"pre-checkout-product-annotation flex flex-row justify-center items-center mt-0 mr-0 mb-2 ml-0",children:[(0,w.jsx)(fe,{dark:!1,width:40,height:40,marginLeft:0,marginTop:0}),(0,w.jsx)("div",{className:"rewards-text text-green-550 font-semibold text-lg",children:r})]}):null}var $=c(M());Ct();v();var q=t=>S("setPreCheckoutDismissThrottle",t);function Ze(){return k(ye)}function et(){return k(Ne)}function tt(){return k(Le)}function ot(){return k(Ue)}function rt(){return k(Ae)}function u(t){let e={anonymized:!1,skipAllowlistCheck:!0,skipSendingPageContextData:!0};t.meta&&typeof t.meta=="object"&&(t.meta=JSON.stringify(t.meta)),b("track",L,t,e)}function X(t){return!t||t===""||t===Ke}var nt=c(M());v();_e();var E=c(p());function te({offer:t,product:e}){let{formatCurrency:o}=(0,nt.useContext)(G),{getValue:n}=P(R.MULTI_OFFER,{defaultValues:{displayReward:t.displayReward}}),r=t.rewardHasPrefix?n("prefixed_rewards_text"):n("rewards_text"),s=e?.price_after_discount?o(e?.price_after_discount):"";return X(e.image)?(g(`Image not found for product: ${e.title}`),null):(0,E.jsxs)("div",{className:"flex flex-col justify-start items-center pt-1 pb-2 pr-2 pl-2 border-solid border border-border rounded-lg robotoRegular w-[166px]",children:[(0,E.jsx)("div",{className:"flex items-center justify-center w-[142px] h-[142px]",children:(0,E.jsx)("img",{className:"max-w-full max-h-full object-contain",src:e.image})}),(0,E.jsxs)("div",{className:"text-base robotoRegular self-start space-y-2",children:[(0,E.jsx)("div",{className:"text-green-550 font-bold text-lg robotoBold",children:r}),(0,E.jsx)("div",{className:"text-base text-blue-700 max-w-[142px] line-clamp-2 h-12",children:e.title}),(0,E.jsx)("div",{className:"text-lg",children:s}),(0,E.jsx)("div",{className:"text-sm line-clamp-2 h-[40px]",children:e.brand})]}),(0,E.jsx)("div",{className:"flex flex-col m-2",children:(0,E.jsx)("a",{href:t.href,target:"_blank",rel:"noopener noreferrer",children:(0,E.jsx)(F,{size:"sm",className:"font-extrabold min-w-[142px] border-none my-1 mr-0",onClick:()=>{u({type:Je,subType:$e,redirect:!0,label:t?.tld??e?.seller,clickId:N(),itemName:e?.title||"",hasOffer:!0})},children:n("cta_button_text")})})})]})}var C=c(p());function oe({offers:t,products:e}){let[o,n]=(0,$.useState)(!0),r=Array.from(t).sort((d,T)=>T.rewardsRate-d.rewardsRate).slice(0,5),s=B(j,60),{getValue:m}=P(R.MULTI_OFFER),f=e.reduce((d,T)=>(d[T.key]=T,d),{});(0,$.useEffect)(()=>{r.some(T=>X(e[T.key].image))&&u({type:Be,subtype:"mo"})},[]);let a=()=>{n(!1);let d=pe(new Date,{minutes:s}).getTime();q({componentName:"mo",throttleValue:d}),u({type:qe,redirect:!1,label:Xe})};return o?(0,C.jsxs)("div",{className:"flex flex-col w-fit justify-center items-start px-4 pt-2 pb-4 border-solid border border-border rounded-lg robotoRegular",children:[(0,C.jsxs)("div",{className:"flex flex-row h-[50px] items-center justify-start w-full",children:[(0,C.jsx)("div",{className:"flex w-[174px]",children:(0,C.jsx)("img",{className:"h-[30px]",src:m("logo")})}),(0,C.jsxs)("div",{className:"flex flex-row justify-between grow pl-6 border-border border-solid border-l",children:[(0,C.jsx)("div",{className:"font-semibold text-base",children:m("title")}),(0,C.jsx)(I,{className:"close-icon w-[16px] h-[16px] pl-[4px] mr-[7px] cursor-pointer text-neutralsecondary",onClick:a})]})]}),(0,C.jsx)("div",{className:"flex flex-row justify-between align-start space-x-4",children:r.map(d=>(0,C.jsx)(te,{offer:d,product:f[d.key]},d.key))})]}):null}var H=c(M());Pt();v();var i=c(p());function K({componentName:t,ctaEventLabel:e,ctaEventType:o,dismissEventType:n,dismissEventLabel:r,lexiScope:s,offers:m,products:f,productClickEventType:a,productClickEventSubType:d}){let T=B(j,60),{formatCurrency:st}=(0,H.useContext)(G),[at,dt]=(0,H.useState)(!0),[lt,pt]=(0,H.useState)(!0),z=m.sort((l,h)=>h.rewardsRate-l.rewardsRate).slice(0,3),ut=f.reduce((l,h)=>(l[h.key]=h,l),{}),_t=()=>{let l=!lt;pt(l),u({type:o,subType:l?"expand":"collapse",redirect:!1,label:e})},mt=()=>{dt(!1);let l=le(new Date,{minutes:T}).getTime();q({componentName:t,throttleValue:l}),u({type:n,redirect:!1,label:r})},de=z.reduce((l,h)=>{if(h.displayReward.indexOf("%")===-1)return l;let O=h.rewardsRate;return O>l?O:l},0),Et=de>0?`${de*.01}%`:"0%",{getValue:D}=P(R[s],{defaultValues:{maxDisplayReward:Et,rewardCount:z.length.toString()}});return at?(0,i.jsx)("div",{className:"flex flex-row w-[330px] align-items-center justify-start mb-2 p-2 border border-solid border-border rounded-lg bg-white",children:(0,i.jsxs)(Ce,{className:"w-full",type:"single",collapsible:!0,defaultValue:"item-1",children:[(0,i.jsxs)("div",{className:"mt-2",children:[(0,i.jsxs)("div",{className:"flex flex-row items-center justify-between w-full",children:[(0,i.jsx)("img",{className:"logo h-[30px]",src:D("logo")}),(0,i.jsx)(I,{className:"close-icon w-[16px] h-[16px] pl-[4px] mr-[7px] cursor-pointer text-neutralsecondary",onClick:mt})]}),(0,i.jsx)("div",{className:"pre-checkout-embedded-right-notification-header-bottom pt-2 text-lg text-gray-750 font-semibold",children:D("title")})]}),(0,i.jsxs)(Te,{value:"item-1",children:[(0,i.jsx)(Pe,{className:"pre-checkout-embedded-right-notification-accordion-trigger border-none shadow-none pt-2",onClick:_t,children:(0,i.jsx)("div",{className:"text-left text-xs",children:(0,i.jsx)("div",{className:"reward text-green-550 text-base font-semibold",children:D("trigger_text_a")})})}),(0,i.jsx)(Re,{className:"pre-checkout-embedded-right-notification-accordion-content -mb-4",children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[z.map((l,h)=>{let O=ut[l.key],ft=O?.price_after_discount?st(O?.price_after_discount):"";return(0,i.jsxs)("div",{className:"offer-item flex flex-row items-center justify-between h-[75px] w-full border-t border-border border-solid",children:[(0,i.jsxs)("div",{className:"offer-item-left flex flex-row",children:[(0,i.jsx)("div",{className:"offer-image-wrapper flex items-center justify-center mr-[18px] w-14 h-16",children:(0,i.jsx)("img",{src:O?.image,className:"offer-image max-w-full max-h-full object-contain"})}),(0,i.jsxs)("div",{className:"offer-details flex flex-col",children:[(0,i.jsx)("a",{className:"offer-title text-[#1A0DAB] text-lg font-normal font-base max-w-[140px] overflow-hidden text-ellipsis whitespace-nowrap",href:l.href,target:"_blank",rel:"noopener noreferrer",onClick:()=>u({type:a,subType:d,redirect:!0,label:l?.tld??O?.seller,clickId:N(),itemName:O?.title||"",hasOffer:!0}),children:O?.brand}),(0,i.jsx)("span",{className:"offer-reward text-green-550 font-medium text-sm",children:D("rewards_text",{parseValues:{displayReward:l.displayReward}})})]})]}),(0,i.jsx)("div",{className:"offer-item-right",children:(0,i.jsx)("span",{className:"offer-price text-neutralprimary font-semibold text-base",children:ft})})]},h)}),(0,i.jsx)("div",{className:"text text-xs text-neutralprimary",children:D("trigger_text_b")})]})})]})]})}):null}var re=c(p());function ne({offers:t,products:e}){return(0,re.jsx)("div",{className:"mt-8",children:(0,re.jsx)(K,{lexiScope:"EMBEDDED_RIGHT",offers:t,products:e,...W.ern})})}var ie=c(p());function ce({offers:t,products:e}){return(0,ie.jsx)("div",{className:"fixed top-0 right-4",children:(0,ie.jsx)(K,{lexiScope:"TOP_RIGHT",offers:t,products:e,...W.trn})})}var A=c(p()),Ut=1695,ae=[],x=[];async function At(){let t=me.get("deweyResult")||{},{pageType:e}=t;if(e==="sponsoredProductsPage"){if(!ge()||(x=t.pageData.products,!x||x.length===0))return!1;let o=x.slice(0,20).map((a,d)=>({key:a.key,url:a.url,domain:a.seller,title:a.title}));if(!Ze())return!1;let{offers:n}=await be(o);if(!n||n.length===0)return!1;let r=ct.default.v4();n.forEach(a=>{a.href=a.href.replace(Me,r)});let s=window.innerWidth,m=vt(),f=We;if(et()){f=Ve;let a=await Dt();if(!a){g("Sponsored button not found, cannot inject pre-checkout button");return}jt(n,a)}else if(tt()&&s>=Ut){let a=await wt();if(!a){g("Sponsored product carousel not found, cannot inject embedded right notification");return}if(await se("ern"))return;Vt(n,x,a)}else if(ot()){if(await se("trn"))return;Wt(n,x)}else if(rt()){let a=document.querySelectorAll(we),d=null;for(let T of a)if(d=T.querySelector(He),d)break;if(!d){g("Injection element not found, cannot inject multi-offer");return}if(await se("mo"))return;if(n.length<3){u({type:ze});return}await Jt(n,x,d)}else u({name:U.HOLDOUT});Ft(n,m,f)}}function Dt(){return new Promise((t,e)=>{Q(()=>document.querySelector(De),o=>{t(o)})})}function vt(){return document.querySelectorAll(V)}function wt(){return new Promise((t,e)=>{Q(()=>document.querySelector(ve),o=>{t(o)})})}function Ht(t){let e=`${V}:nth-child(${parseInt(t)+1})`;return document.querySelector(e)}function Kt(t){let e=`${V}:nth-child(${parseInt(t)+1}) a`;return document.querySelectorAll(e)}function Mt(t){let e=document.createElement("div");return e.classList.add(`sponsored-product-outer-wrapper-${t}`),e.style.marginRight="8px",e}function Bt(t){let e=document.createElement("div");return e.classList.add(`sponsored-product-inner-wrapper-${t}`),e.style.borderStyle="solid",e.style.borderWidth="1px",e.style.borderColor="green",e.style.padding="4px 4px 0 4px",e.style.borderRadius="8px",e}function Ft(t,e,o){e.forEach((n,r)=>{let s=t.find(f=>f.key===r.toString());Kt(r.toString()).forEach(async f=>{f.addEventListener("click",()=>{s&&Ie(s.tld,s.token),u({type:Y,subType:o,redirect:!0,label:s?.tld??x[r]?.seller,clickId:N(),carouselPosition:r,itemName:x[r]?.title||"",hasOffer:!!s})})})})}async function Gt(t){t.forEach(async e=>{let o=Ht(e.key);if(!o)return;let n=Mt(e.key),r=Bt(e.key);n.appendChild(r),o.parentNode?.replaceChild(n,o),r.appendChild(o);let m=await y({appName:"preCheckout",cssUrl:"preCheckout.css",app:(0,A.jsx)(ee,{displayReward:e.displayReward,enabled:!0,rewardHasPrefix:e.rewardHasPrefix}),insertAfterElement:r});ae.push(m)}),u({type:Fe,redirect:!1,label:Ge})}function Yt(t){t.forEach(e=>{let o=document.querySelector(`.sponsored-product-outer-wrapper-${e.key}`);if(o){let n=o.querySelector(`.sponsored-product-inner-wrapper-${e.key}`);if(n){let r=n.firstChild;r&&o.replaceWith(r)}}}),ae.forEach(e=>{e.unloadApp()}),ae.length=0,u({type:Ye,redirect:!1,label:je})}async function se(t){let e=await ke({componentName:t});return ue(new Date,new Date(e))}function jt(t,e){y({appName:"preCheckout",cssUrl:"preCheckout.css",app:(0,A.jsx)(J,{onShowProductAnnotations:()=>Gt(t),onHideProductAnnotations:()=>Yt(t)}),insertBeforeElement:e,mountClass:"_14f4nnk",positionOnTop:!1}),u({name:U.INJECTED_BUTTON})}function Vt(t,e,o){y({appName:"preCheckout",cssUrl:"preCheckout.css",app:(0,A.jsx)(ne,{offers:t,products:e}),insertAfterElement:o,mountClass:"_25pcern",mountPointStyle:"margin-bottom: -500px; margin-left: 10px;"}),b("track",L,{name:U.EMBEDDED_RIGHT})}function Wt(t,e){y({appName:"preCheckout",cssUrl:"preCheckout.css",app:(0,A.jsx)(ce,{offers:t,products:e}),mountClass:"_25pctrn"}),b("track",L,{name:U.TOP_RIGHT_OVERLAY})}async function Jt(t,e,o){await y({appName:"preCheckout",cssUrl:"preCheckout.css",app:(0,A.jsx)(oe,{offers:t,products:e}),mountClass:"_25pcmo",insertAfterElement:o,positionOnTop:!1});let n=document.querySelector("._25pcmo"),r="unknown";if(n){let s=window.innerHeight,{bottom:m,top:f}=n.getBoundingClientRect();f>s?r="fully-beneath":m<s?r="fully-above":r="partial"}b("track",L,{name:U.EMBEDDED_MULTI_OFFER,verticalLocation:r})}async function it(){await At()}document.readyState!=="loading"?it():document.addEventListener("DOMContentLoaded",it);
