import{a as L}from"../chunks/chunk-QOGXVR6U.js";import{b as R,c as h}from"../chunks/chunk-2R34RLZD.js";import{a as A}from"../chunks/chunk-VMXEY2MG.js";import{a as $}from"../chunks/chunk-DYSWDVEG.js";import{a as K}from"../chunks/chunk-VQDKWH7E.js";import{a as M,b as x,n as N,o as V}from"../chunks/chunk-W54VV7FS.js";import{a as O}from"../chunks/chunk-67GETEJS.js";import"../chunks/chunk-Z6KOSB5X.js";import"../chunks/chunk-IQFNOK3G.js";import"../chunks/chunk-35WHJZQO.js";import"../chunks/chunk-NUCLT2FJ.js";import"../chunks/chunk-2IU7RY3W.js";import"../chunks/chunk-542QW3ZK.js";import"../chunks/chunk-IYAFYZRF.js";import"../chunks/chunk-JNO5G2QC.js";import"../chunks/chunk-ZRXJBILZ.js";import"../chunks/chunk-F2BE3OL5.js";import"../chunks/chunk-AZABECDO.js";import"../chunks/chunk-AJE3NLZ4.js";import"../chunks/chunk-TOX56BBT.js";import"../chunks/chunk-TYA5STFG.js";import"../chunks/chunk-KWORSN6K.js";import{o as q}from"../chunks/chunk-TXXCCNWI.js";import{a as Y}from"../chunks/chunk-O4TFJKJQ.js";import{a as k,b as P,g as S,m as D,s as u,t as _,u as l,w as v}from"../chunks/chunk-CHZKSFGE.js";import"../chunks/chunk-KNMLYUAT.js";import"../chunks/chunk-54ERVKKM.js";import"../chunks/chunk-JLZNCAMO.js";import"../chunks/chunk-PVPCVBPO.js";import"../chunks/chunk-Z4H6U7OH.js";import"../chunks/chunk-LIVBINA3.js";import"../chunks/chunk-HQ4MM2EX.js";import"../chunks/chunk-4TYY7CF3.js";import"../chunks/chunk-VCHBXYSK.js";import"../chunks/chunk-ZIVQ3XHH.js";import"../chunks/chunk-JDJMGFXU.js";import"../chunks/chunk-T5WNPH4X.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import{a as m,c as W}from"../chunks/chunk-IUWVXOWN.js";import{c as E}from"../chunks/chunk-HPNQXUCM.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-KUOYBGP4.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-KSIO6WHA.js";import"../chunks/chunk-BETA3R27.js";import{e as C}from"../chunks/chunk-3GYLW4KZ.js";var H=C(Y()),i=C(E());var s=C(E());W();var F=(e,o)=>O("deweyPriceComparisonWithoutNotif",{priceComparisonKey:e,product:o});var d,T,G=250,j=2500;function J(e){return e.url}async function Q(e){let o=e?.pageTypeBehaviors,n=(Array.isArray(o?.notifPlacementSelectors)?o.notifPlacementSelectors:[]).map(({value:a})=>a);return{runOptions:{input:{}},buttonShouldMountInline:!!n.length,findElementToInsertAfter:()=>{for(let a of n){let c=document.querySelector(a);if(c)return c}},showNotification:o?.showNotification,priceThresholdCents:o?.deweyPCThreshold||j}}function X(e,o){return e.price?M(e.price,o,"disable_universal_price_run")?!1:{priceComparisonKey:J(e)}:(m("Dewey PC - unable to retrieve the origin product price."),!1)}function z(e){try{T||(T=s.default.debounce(Z,G)),T(e)}catch(o){m(o)}}async function Z(e){try{if(!(!L()&&u("dewey_price_comparison")&&s.default.get(e,"pageTypeBehaviors.deweyPC",!1))||s.default.get(e,"domain")==="amazon.com")return;let t=s.default.cloneDeep(s.default.get(e,"pageData.products[0]",{}));t.vendor=s.default.get(e,"domain"),t.price=t.list_price,t.mpn=t.manufacturer_number,delete t.list_price,delete t.manufacturer_number;let n=await Q(e),a=X(t,n?.priceThresholdCents);if(!n?.showNotification)return u("dewey_price_comparison_silent")&&a&&F(a.priceComparisonKey,t);if(!a){d="",q(N);return}let{priceComparisonKey:r}=a;if(r===d){m(`*** Skipping dewey price comparison already in progress for request - ${r} ***`);return}m(`*** Starting dewey price comparison. Request - ${r} ***`),d=r,n.runOptions.input.product=t,s.default.set(n.runOptions.input,"meta.conquestOrigin",!0),s.default.set(n.runOptions.input,"meta.simpleOriginPricing",!0),s.default.set(n.runOptions.input,"deweyPC",!0);let p=n.findElementToInsertAfter();await V({insertAfterElement:p,removeExistingApp:!0},{...n.runOptions,buttonNotMountedInline:n.buttonShouldMountInline&&!p,pageType:x[e.pageType],isFloatingNotif:u("price_comparison_floating_notif_non_amz"),runCompleteCb:()=>{d&&d===r&&(d="",m(`*** Request - ${r} - completed ***`,"*** Active Dewey price comparison was reset. ***"))}})}catch(o){m(o)}}var B=e=>(z(e),v("deweyResult",e));window.__wb_timing.deweyRequireAt=performance.now();async function I(){await Promise.all([K(),A()]).then(([e,o])=>{$(e),D.merge({siteAPIData:o})}),u("ext_instant_init_notifs")||document.readyState!=="loading"?b():document.addEventListener("DOMContentLoaded",b)}async function b(){let e=D.get("siteAPIData"),o=i.default.get(e,"tld");P(o),e=await ee(e)||e;let t=i.default.cloneDeep(e);t.document=document,t.document.deweyParser=H.default,t.document.html=document.documentElement.innerHTML,i.default.set(t,"siteData.tld",t.tld),h.setDefaultConfig(t);let n=u("log_all_dewey"),a=new Date,c=new Set(i.default.map(i.default.get(e,"siteData.tigger.coupons")||i.default.get(e,"siteData.roo.coupons")||[],"code"));h.emitter.on("result",async r=>{let p=r?.pageType,y=!1,f=await R(r);if(f.callSource==="internal"&&(D.set(["deweyResult"],f),B(f),p||n)){let w=new Date-a,g=i.default.cloneDeep(f);g&&g.pageData&&g.pageData.meta&&(g.pageData.meta=[g.pageData.meta]);let U=!y&&p!=="sponsoredProductsPage"?void 0:{anonymized:y,skipAllowlistCheck:p==="sponsoredProductsPage",skipSendingPageContextData:p==="sponsoredProductsPage"};_("track","deweyResult",i.default.assign({},g,{flags:i.default.get(e,"siteData.flags"),logAllDewey:n,totalTimeElapsed:w,deweyAttempt:h.startAttempt,emailId:D.get("emailId")}),U)}i.default.get(f,"pageData.coupons.length")&&i.default.forEach(f.pageData.coupons,w=>{c.has(w)||(_("track","codeApplied",{code:w,currentLocation:i.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}),c.add(w))})}),h.start()}async function ee(e){let o=i.default.get(e,"siteData.coupons.type"),[t,n=k()]=await Promise.all([S({message:"getPlatform"}),S({message:"getPlatformDomain"})]);if(t&&n){P(n),e=i.default.has(e,"siteData.tigger")?e:{...e,siteData:{...e.siteData,tigger:{}}},e.siteData.tigger[`${t.toLowerCase()}`]=!0,e.siteData.pageTypesV2=e.siteData.pageTypesV2||{};let{cartPage:a,checkoutPage:c,confirmationPage:r}=e.siteData.pageTypesV2;new Set(["Magento","WooCommerce","BigCommerce","Squarespace"]).has(t)?(t==="Magento"&&(e.siteData.pageTypesV2.cartPage=a||await l.default.getSiteData(t,"cartPage")),e.siteData.pageTypesV2.checkoutPage=c||await l.default.getSiteData(t,"checkoutPage"),e.siteData.pageTypesV2.confirmationPage=r||await l.default.getSiteData(t,"confirmationPage")):(e.siteData.pageTypesV2.checkoutPage=await l.default.getSiteData(t,"checkoutPage"),e.siteData.pageTypesV2.confirmationPage=await l.default.getSiteData(t,"confirmationPage"));let y=await l.default.getSiteData(t,"roo");return y&&o!=="roo"&&(e.siteData.roo=y),e}}I();
