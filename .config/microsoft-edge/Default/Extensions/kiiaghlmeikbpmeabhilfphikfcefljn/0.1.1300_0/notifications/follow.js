import{a as A}from"../chunks/chunk-DB2INE3Z.js";import{a as L}from"../chunks/chunk-5DIWEA5K.js";import{b as V,e as E}from"../chunks/chunk-C3OCDYXE.js";import"../chunks/chunk-2R34RLZD.js";import{a as U}from"../chunks/chunk-VMXEY2MG.js";import{a as q}from"../chunks/chunk-DYSWDVEG.js";import{a as W}from"../chunks/chunk-VQDKWH7E.js";import{b as I,c as T}from"../chunks/chunk-542QW3ZK.js";import"../chunks/chunk-IYAFYZRF.js";import{a as F,e as M}from"../chunks/chunk-JNO5G2QC.js";import"../chunks/chunk-ZRXJBILZ.js";import"../chunks/chunk-F2BE3OL5.js";import{a as D}from"../chunks/chunk-AZABECDO.js";import"../chunks/chunk-AJE3NLZ4.js";import{a as Z}from"../chunks/chunk-TOX56BBT.js";import"../chunks/chunk-TYA5STFG.js";import{a as R}from"../chunks/chunk-KWORSN6K.js";import{c as C,e as m,p as O}from"../chunks/chunk-TXXCCNWI.js";import"../chunks/chunk-O4TFJKJQ.js";import{m as l,t as d,w as u}from"../chunks/chunk-CHZKSFGE.js";import"../chunks/chunk-4TYY7CF3.js";import"../chunks/chunk-VCHBXYSK.js";import"../chunks/chunk-ZIVQ3XHH.js";import"../chunks/chunk-JDJMGFXU.js";import{z as N}from"../chunks/chunk-T5WNPH4X.js";import"../chunks/chunk-ECXCPAF6.js";import"../chunks/chunk-CBPLEXH3.js";import"../chunks/chunk-IUWVXOWN.js";import{b as Q,c as y}from"../chunks/chunk-HPNQXUCM.js";import"../chunks/chunk-53OM6ECF.js";import"../chunks/chunk-KUOYBGP4.js";import"../chunks/chunk-PDIOZR2P.js";import"../chunks/chunk-KSIO6WHA.js";import"../chunks/chunk-BETA3R27.js";import{e as c}from"../chunks/chunk-3GYLW4KZ.js";var K=c(Q()),S=c(y());var H=c(N()),g=c(Z()),n=c(y());var f=c(y());var $=e=>u("addVote",e);var z=e=>u("getFeedbackData",e);function h(e){return e=e==="video"?"review":e,e==="advice"?e:`${e}s`}async function tt(){let e=l.get(["ProductPage","inputData","product"]),t=l.get(["ProductPage","inputData","asin"]),o=l.get(["ProductPage","inputData","feedback"]),i=l.get(["session","id"]),a=e&&e.wbpid?e.wbpid:`amazon.com_${t}`,s=await z({wbpid:a,userId:i,product:e,meta:o});l.set(["ProductPage","feedbackData"],s)}function et(e,t){let o=(t||e).split(".")[0];o==="video"&&(o="review");let i=l.get(["ProductPage","feedbackData"]),a;if(t){let s=f.default.find(i[h(o)],{id:t});a=f.default.find(f.default.get(s,"comments"),{id:e})}else i&&(a=f.default.find(i[h(o)],{id:e}));return{feedback:a,type:o}}function ot({feedback:e,updatedFeedback:t,type:o,data:i}){i.parent_id?(l.select(["ProductPage","feedbackData",h(o),{id:i.parent_id}]).set(["comments",{id:i.id}],t),i.parent_id===l.get(["selectedFeedback","id"])&&l.set(["selectedFeedback","comments",{id:i.id}],t)):(l.merge(["ProductPage","feedbackData",h(o),{id:i.id}],t),e.id===l.get(["selectedFeedback","id"])&&l.set(["selectedFeedback"],t))}function it({feedback:e,type:t}){let o=l.get(["ProductPage","feedbackData",h(t)]);o&&(o.push(e),l.set(["ProductPage","feedbackData",h(t)],o),l.commit())}async function x(e){let t=l.get(["session","id"]),{feedback:o,type:i}=et(e.id,e.parent_id);function a(s){return s=f.default.clone(s),s.up_votes=s.up_votes||0,s.down_votes=s.down_votes||0,s.up_votes=e.upVote?s.up_votes+1:s.up_votes,s.down_votes=e.upVote?s.down_votes:s.down_votes+1,s.vote_selection==="up_vote"&&(s.up_votes-=1),s.vote_selection==="down_vote"&&(s.down_votes-=1),s.vote_selection=e.upVote?"up_vote":"down_vote",s}if(o){let s=a(o);ot({feedback:o,updatedFeedback:s,type:i,data:e})}else{let s=a(e);it({feedback:s,type:i})}await $(f.default.assign({userId:t},e)),await tt()}var Y=e=>u("toggleMatchSurvey",e);var r=c(m()),v=class extends H.Component{constructor(...t){super(...t),this.state={title:"Was this a good result?",subtitle:"Your feedback helps other Capital One Shoppers.",hideNotification:!0,showReasons:!1,showComment:!1,selectedReasons:[],reasonText:"",dismiss:!1}}componentDidMount(){d("page","matchSurvey",{view:"matchSurvey",type:"notification",offerSignUp:n.default.get(this.props.view,"offerSignUp"),qualified:n.default.get(this.props.view,"qualified",!1),balance:n.default.get(this.props.view,"balance",0)}),setTimeout(()=>{this.setState({hideNotification:!1})},1e3)}componentWillReceiveProps(t){n.default.get(t,"view.hiddenFromWebApp")&&!n.default.get(this.props,"view.hiddenFromWebApp")&&this.setState({hideNotification:!0})}onChange(t,o){if(o.type==="input")return;let i=this.state.selectedReasons,a=i.indexOf(t);a===-1?i.push(t):i.splice(a,1),this.setState({selectedReasons:i})}onTextUpdate(t){let o=t.target.value;this.setState({reasonText:o})}renderReasons(){let t=["Not the same product","Price is incorrect","Out of stock","Item condition","Bad seller","Other"],o;return this.state.showReasons&&(o=n.default.map(t,(i,a)=>{let s=this.state.selectedReasons.indexOf(i)!==-1;return(0,r.jsxs)("div",{className:"reason",children:[(0,r.jsx)("input",{type:"checkbox",checked:s,onChange:this.onChange.bind(this,i),id:n.default.kebabCase(i)}),(0,r.jsx)("label",{htmlFor:n.default.kebabCase(i),children:(0,r.jsx)("h5",{className:"text",children:i})})]},n.default.kebabCase(i))})),(0,r.jsxs)("div",{className:"reasons-wrapper",children:[o,(0,r.jsx)("textarea",{placeholder:"tell us more",value:this.state.reasonText,onChange:this.onTextUpdate.bind(this)}),(0,r.jsx)("button",{className:"primary-btn-small",onClick:this.onSubmit.bind(this),children:"Submit"})]})}render(){let{hideNotification:t}=this.state,o=this.state.title,i=this.state.subtitle,a=!1,s=!1,p;return this.state.showReasons||this.state.showComment?p=this.renderReasons():this.state.dismiss||this.state.buttonsHidden?p=(0,r.jsx)("div",{className:"thanks-wrapper"}):p=(0,r.jsxs)("div",{className:"button-wrapper",children:[(0,r.jsx)("button",{className:"secondary-btn-small",onClick:this.onYes.bind(this),children:"Yes"}),(0,r.jsx)("button",{className:"secondary-btn-small",onClick:this.onNo.bind(this),children:"No"})]}),(0,r.jsx)("div",{className:t?"disabled follow-page":"follow-page",style:{top:a?"0":"auto",bottom:a?"auto":"0",left:s?"auto":"0",right:s?"0":"auto"},children:(0,r.jsx)(g.Motion,{style:{opacity:(0,g.spring)(t?0:1,{stiffness:180,damping:20}),y:(0,g.spring)(t?a?-100:100:0,{stiffness:180,damping:20})},children:({opacity:_,y:J})=>(0,r.jsxs)("div",{className:"follow-notification",style:{transform:`translate3d(0,${J}%,0)`,opacity:`${_}`},children:[(0,r.jsxs)("header",{style:{display:"flex",justifyContent:"space-between"},children:[(0,r.jsx)(R,{}),(0,r.jsx)(D,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,r.jsxs)("section",{children:[(0,r.jsx)("h2",{children:o}),i?(0,r.jsx)("h4",{children:i}):null,p]})]})})})}onYes(){let t=n.default.get(this.props,"view.resultData");x({up_votes:0,down_votes:0,id:`product.${n.default.get(t,"details.product.wbpid")}`,wbpid:n.default.get(t,"run.originResult.product.wbpid"),match_wbpid:n.default.get(t,"details.product.wbpid"),upVote:!0}),this.onNotificationInteraction(),this.setState({match:!0,title:"Thanks!",subtitle:"Your vote helps improve results for everyone on Capital One Shopping.",buttonsHidden:!0}),this.timeout=setTimeout(()=>{this.setState({hideNotification:!0})},2500);let o={match:!0,quoteId:n.default.get(t,"run.id"),matchId:n.default.get(t,"details.id"),notification:!0,mpnBrandMatch:n.default.get(t,"details.meta.imsMpnBrandMatch",!1),certifiedRefurbished:n.default.get(t,"details.certifiedRefurbished",!1)};d("track","matchSurvey",o)}onNo(){let t=n.default.get(this.props,"view.resultData");x({up_votes:0,down_votes:0,id:`product.${n.default.get(t,"details.product.wbpid")}`,wbpid:n.default.get(t,"run.originResult.product.wbpid"),match_wbpid:n.default.get(t,"details.product.wbpid"),upVote:!1}),this.onNotificationInteraction(),this.setState({match:!1,showReasons:!0,showComment:!0,title:"Uh oh!",subtitle:"What was wrong with this result?"});let o={match:!1,quoteId:n.default.get(t,"run.id"),matchId:n.default.get(t,"details.id"),notification:!0,mpnBrandMatch:n.default.get(t,"details.meta.imsMpnBrandMatch",!1),certifiedRefurbished:n.default.get(t,"details.certifiedRefurbished",!1)};d("track","matchSurvey",o)}onSubmit(){this.onNotificationInteraction();let t=n.default.get(this.props,"view.resultData"),o={match:this.state.match,quoteId:t.run.id,matchId:t.details.id,notification:!0};this.state.reasonText&&(o.text=this.state.reasonText),this.state.selectedReasons&&this.state.selectedReasons.length&&(o.reason=n.default.get(this.state.selectedReasons,"[0]"),o.reasons=this.state.selectedReasons),d("track","matchSurveyReason",o),this.setState({dismiss:!0,showReasons:!1,showComment:!1,title:"Thanks for helping!",subtitle:"The next Capital One Shopper will benefit from your contribution."}),setTimeout(()=>this.onClosePopup("submit"),3200)}onClosePopup(t){this.onNotificationInteraction(),this.setState({hideNotification:!0}),d("trackClick","dismissMatchSurvey",t)}onNotificationInteraction(){Y(n.default.get(this.props,"view.resultData"))}componentWillUnmount(){clearTimeout(this.timeout)}},P=C({view:["followView"],events:["events"],session:["session"]},v);var k=c(N());async function j(e){let t=I(e),o=await T(t),i={rootEl:"div",logLevel:null},a=await E();return{config:i,content:o,...a}}var b=c(m());function B({onUnload:e,blocksParams:t,blocksSlug:o,templateData:i}){let[a,s]=(0,k.useState)(t);return(0,k.useEffect)(()=>{async function p(){try{let _=await j(o);s(_)}catch(_){console.error(_)}}p()},[]),a?(0,b.jsx)(M,{client:F.DESKTOP_WEB,config:a.config,content:a.content,host:a.host,user:a.user,data:i,onEvent:p=>V(p,e)}):(0,b.jsx)("div",{className:"flex flex-1 align-center justify-center",children:(0,b.jsx)(L,{})})}var w=c(m());window.__wb_timing.followRequireAt=performance.now();function st(){return K.default.all([W(),U(),A()]).spread((e,t,o)=>{q(e),l.merge({siteAPIData:t}),l.set("lifetimeSavings",o)})}var X;function nt(){X?.()}async function G(){await st();let e=l.get(["followView","resultData"]),t=S.default.get(e,"details.pricing.coupons.length"),o=S.default.get(e,"origin")==="extension";X=(await O({appName:"follow",cssUrl:"follow.css",app:(0,w.jsx)(w.Fragment,{children:t||o?(0,w.jsx)(B,{onUnload:nt,blocksSlug:"savings-notification"}):(0,w.jsx)(P,{})})})).unloadApp}document.readyState!=="loading"?G():document.addEventListener("DOMContentLoaded",G);
