/*!
 * ExtSinglePageOpener
 * Part of the ExtHelpers project
 * @version  v1.7.2
 * @author   Gerrproger
 * @license  MIT License
 * Repo:     http://github.com/gerrproger/ext-helpers
 * Issues:   http://github.com/gerrproger/ext-helpers/issues
 */(function(i,s){"use strict";typeof module=="object"&&typeof module.exports=="object"?module.exports=s(i,document):typeof define=="function"&&define.amd?define(null,function(){s(i,document)}):i.ExtSinglePageOpener=s(i,document)})(typeof window<"u"?window:this,function(i){"use strict";class s{constructor(){this.isBackgroundScript=!!(chrome.extension.getBackgroundPage&&chrome.extension.getBackgroundPage()===i),this.pages=new Map,this.isBackgroundScript&&this._prepareBackground()}_prepareBackground(){chrome.runtime.onMessage.addListener((e,t,r)=>{if(e.extSinglePageOpener)return this._openBackground(e.extSinglePageOpener,r),!0})}_openBackground(e,t){const r=this._getUrl(e),o=this._splitUrl(r),n=this.pages.get(o[0]),u={active:!0};if(!n){this._openNewTab(e,t);return}chrome.tabs.get(n,c=>{if(chrome.runtime.lastError||!c){this._openNewTab(e,t);return}o.length>1&&(u.url=r),chrome.windows.update(c.windowId,{focused:!0}),chrome.tabs.update(c.id,u,t)})}_openContent(e,t){chrome.runtime.sendMessage({extSinglePageOpener:e},r=>{if(chrome.runtime.lastError||!r)throw new Error("ExtSinglePageOpener should also be initialized in the background page script!");t.call(i,r)})}_openNewTab(e,t){const r=this._getUrl(e),o=n=>{this.pages.set(this._splitUrl(r)[0],n.id),t.call(i,n)};if(e.type){chrome.windows.create({...e,focused:!0,url:r},n=>{o(n.tabs[0])});return}chrome.windows.getCurrent({},n=>{if(n){chrome.windows.update(n.id,{focused:!0}),chrome.tabs.create({url:r},o);return}chrome.windows.create({focused:!0,url:r},u=>{o(u.tabs[0])})})}_getUrl(e){const t=e.url||e,r=t.match(/^@@dir(.*)/);return r?chrome.extension.getURL(r[1]):t}_splitUrl(e){return e.split(/\?|#/)}open(e,t=()=>{}){if(typeof t!="function")throw new Error("Callback should be a function!");if(!e||!(typeof e=="string"||typeof e=="object"&&typeof e.url=="string"))throw new Error("URL or settings object with URL string is not provided!");this.isBackgroundScript?this._openBackground(e,t):this._openContent(e,t)}}return s});
