import{a as T}from"./chunk-5JMRRCOD.js";import{b,c as O,e as S}from"./chunk-C3OCDYXE.js";import{c as r,f as U}from"./chunk-XNQV75SS.js";import{b as h}from"./chunk-2IU7RY3W.js";import{a as y,c as _}from"./chunk-542QW3ZK.js";import{a as x,b as f,e as D}from"./chunk-JNO5G2QC.js";import{e as v,p as N}from"./chunk-TXXCCNWI.js";import{m as a,s as k,t as m,w as c}from"./chunk-CHZKSFGE.js";import{a as A,c as F}from"./chunk-IUWVXOWN.js";import{c as g}from"./chunk-HPNQXUCM.js";import{e as p}from"./chunk-3GYLW4KZ.js";var M=p(g());F();U();var R=t=>c("confirmEmailAddress",t);var I=t=>c("emailCreateAccount",t);var B=t=>c("postCheckoutCreateAccount",t);var V=p(g());function C(t){let e;if(t&&t.responseText)try{e=V.default.get(JSON.parse(t.responseText),"error")}catch{e=null}return e}async function ie(t){try{return await R(t)}catch(e){return{error:C(e)||"There was an error"}}}async function d(t){try{return await I(t)}catch(e){return{error:C(e)||"There was an error"}}}async function ce(t){try{return await B(t)}catch(e){return{error:C(e)||"There was an error"}}}var P=p(v()),E;async function H(t,e){switch(b(t,e),t.type){case f.Destroy:a.set("emailCreateAccountVisible",!1);break;case f.NotificationShow:m("track","extEmailCreateAccount",{action:"seen"});break;case f.NotificationDismiss:await d({message:"dismiss"}),m("track","extEmailCreateAccount",{action:"dismissed"}),a.set("emailCreateAccountVisible",!1);break;case f.Custom:t.eventName==="onCreateAccountClick"?(await d({message:"clickedCreateAccount"}),m("track","extEmailCreateAccount",{action:"clicked"})):t.eventName==="onSignInClick"&&(await d({message:"clickedSignIn"}),m("track","extEmailCreateAccount",{action:"signIn"})),a.set("emailCreateAccountVisible",!1),e?.();break}}function J(t){let e=t||a.get(["cashback","reward"]);if(!e)return"Rewards";let n=e.categories||e.estimated?"up to ":"";if(e.type==="percentage")return`${n} ${e.amount/100}% Rewards`;let s=e.tiers?.length?e.tiers[e.tiers.length-1].reward.value:e.amount,o=e.tiers?.length?e.tiers[e.tiers.length-1].spendCents||e.tiers[e.tiers.length-1].spend_cents:e.threshold,i=e.type==="threshold"&&o?h(o,{currency:e.amountCurrency||e.currency}):"",l=e.type==="threshold"&&o?` when you spend ${i}`:"",u=h(s,{currency:e.amountCurrency||e.currency});return`${n+u} Rewards${l}`}async function K(t,e=!1){if(await Y(e)){A("*** emailCreateAccount: showing notification");let s=y("email-create-account-block-notification"),o=k("should_use_blocks_service")&&s?await _(s):void 0;if(!o)return;let i=J(t),{user:l,host:u}=await S(),L={rootEl:"div",logLevel:void 0};E?.(),E=(await N({appName:"emailCreateAccountNotification",blankSlate:!0,app:(0,P.jsx)(D,{client:x.DESKTOP_WEB,config:L,content:o,data:{rewardsText:i},host:u,user:l,onEvent:$=>H($,E),onRequest:O})})).unloadApp,a.set("emailCreateAccountVisible",!0)}}async function W(){let t=await d({message:"getEvents"}),e=M.default.chain(t).pickBy(u=>new Date().valueOf()-new Date(u).valueOf()<2592e6).value(),n=r.clickedSignIn in e&&new Date().valueOf()-new Date(e[r.clickedSignIn]).valueOf()<864e5;if(r.clickedCreateAccount in e&&new Date().valueOf()-new Date(e[r.clickedCreateAccount]).valueOf()<864e5||n)return!0;let o=r.seenEmailCreateAccount1 in e&&r.seenEmailCreateAccount2 in e&&r.seenEmailCreateAccount3 in e,i=new Date(Math.max(new Date(e[r.seenEmailCreateAccount1]||0).valueOf(),new Date(e[r.seenEmailCreateAccount2]||0).valueOf(),new Date(e[r.seenEmailCreateAccount3]||0).valueOf())),l=i&&new Date().valueOf()-i.valueOf()<864e5;return!!(o||l)}async function Y(t=!1){A("*** emailCreateAccount: evaluating...");let e=a.get("emailCreateAccountVisible");return T()||e?!1:t?!0:!await W()}export{ie as a,ce as b,K as c,Y as d};
