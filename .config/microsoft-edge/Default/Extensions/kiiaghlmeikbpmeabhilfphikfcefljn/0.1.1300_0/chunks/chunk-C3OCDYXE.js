import{c as m}from"./chunk-2R34RLZD.js";import{b as r,c as g}from"./chunk-JNO5G2QC.js";import{l as i,q as y}from"./chunk-CHZKSFGE.js";import{e as p,g as d,s as P}from"./chunk-BETA3R27.js";P();async function l(){let t=i.tree.get(["deweyResult"]);if(t)return t;let n=new p;return m.emitter.on("result",async o=>{n.next(o)}),d(n.asObservable())}var u="blocksNotification";function T({type:t,name:n,shouldSendTracking:o,throttleDurationMs:a,throttleKey:e,pageType:s,propsData:c={}}){o&&f({extensionTrackingType:"page",name:n},{pageType:s,type:t,...c}),a&&i.throttleExperience(e)}function D({type:t,name:n,dismissLabel:o,shouldSendTracking:a,pageType:e,propsData:s={}}){a&&f({extensionTrackingType:"track",name:n},{dismissLabel:o,pageType:e,type:t,...s})}function v({type:t,name:n,shouldSendTracking:o,pageType:a,propsData:e={}}){if(!o)return;let{name:s,...c}=e;f({extensionTrackingType:"page",name:n},{pageType:a,type:t,...c})}function w({type:t,name:n,shouldSendTracking:o,propsData:a={}}){o&&f({extensionTrackingType:"track",name:n},{type:t,...a})}function f({extensionTrackingType:t,name:n},...o){i.sendMetric(t,n,{view:u,type:"notification",...o.reduce((a,e)=>({...a,...e}),{})})}function C(t,n){let o=t.data?.propsData?.shouldsendtracking,a=typeof o=="boolean"?o:!0;switch(t.type){case r.Destroy:n?.();break;case r.NotificationShow:{let e=t.data;T({type:t.type,name:e?.notificationName||t.type,shouldSendTracking:a,content:e?.notificationContent,throttleDurationMs:e?.throttleDurationMs,throttleKey:e?.throttleKey??u,pageType:e?.pageType,propsData:e?.propsData});break}case r.NotificationDismiss:{let e=t.data;D({type:t.type,name:e?.notificationName||t.type,content:e?.notificationContent,dismissLabel:e?.dismissLabel??"",shouldSendTracking:a,pageType:e?.pageType,propsData:e?.propsData});break}case r.PageView:{let e=t.data;v({type:t.type,name:e?.name||e?.propsData?.name||t.type,shouldSendTracking:a,pageType:e?.pageType,propsData:e?.propsData});break}case r.Custom:{let e=t.data;w({type:t.type,name:t.eventName||t.type,shouldSendTracking:a,propsData:e?.propsData});break}}}async function B(t){switch(t.type){case g.CheckNotifThrottled:{let n=t.data;return i.experienceIsThrottled(n?.throttleDurationMs,n?.throttleKey)}}}var K=async()=>{let t=null;try{t=(await chrome.storage.sync.get("profileId")).profileId}catch{console.error("could not get profileId from local storage")}let n=i.tree.get(["session","id"]),o=i.tree.get("siteAPIData"),a=o?.siteData?.cashback?.reward||{},e=(await l())?.pageType,s={domain:o?.tld,merchant:o?.vendorName,siteCurrency:o?.siteData?.merchantPage?.currency,pageType:e,siteReward:a},c={featureFlags:y(),profileId:t??void 0,id:n??void 0};return{host:s,user:c}};export{u as a,C as b,B as c,l as d,K as e};
