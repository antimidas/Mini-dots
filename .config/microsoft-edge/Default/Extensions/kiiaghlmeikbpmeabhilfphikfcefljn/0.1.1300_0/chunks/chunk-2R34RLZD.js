import{a as R}from"./chunk-ZRXJBILZ.js";import{a as V}from"./chunk-O4TFJKJQ.js";import{l as C}from"./chunk-CHZKSFGE.js";import{a as P}from"./chunk-4TYY7CF3.js";import{b as y,c as g}from"./chunk-IUWVXOWN.js";import{c as I}from"./chunk-HPNQXUCM.js";import{g as T,k as A,s as L}from"./chunk-BETA3R27.js";import{e as i}from"./chunk-3GYLW4KZ.js";L();g();async function w(){document.readyState==="loading"&&(await T(A(document,"DOMContentLoaded")),y("DOMContentLoaded"))}var M=i(R()),x=i(V()),c=i(I()),m=i(P());g();var l;async function S(n){let s=c.default.cloneDeep(n||{});return await C.applyDeweyResultModificationsCallback(s),s}function k(){let n,s;function a(){if(n)return n;s="async";let e=new m.Dewey;e._isasync=!0,e.setDocument(document),e.setParser(x.default),n=e;let t=!1;return n.startAttempt=0,n.deweyMode=s,n.pageTypeComplete=(r,o)=>{t||(t=!0)},n.emitter.on("result",r=>{let o=c.default.get(r,"pageType");o&&n.pageTypeComplete(o,"emitter")}),n}let f=!1,d={get deweyMode(){return a().deweyMode},get startAttempt(){return a().startAttempt},setDefaultConfig:e=>{a().setDefaultConfig(e)},get emitter(){return a().emitter},evaluateIdentifierTree:async(e,t)=>{let r=a();if(r._isasync){let o=t,p=t.deweyParser;return await m.evaluateIdentifierTree({identifiers:e,parser:p,evalDocument:o,matchTypes:{url:0,title:0,selectors:[]}})}return r.evaluateIdentifierTree(e,t)},run:async(e,t)=>{y("dewey.run",{input:e,trigger:t});let r=a(),o={...e,ensureUrlTriggerIsPresent:!0};return r.run(o,t)},start:()=>{if(f)return;f=!0;let e=performance.now();y("dewey.start");let t=a();t.extractVarsSplit=!0;let r=(0,M.exponential)({randomisationFactor:0,initialDelay:50,maxDelay:3e3});async function o(){await w(),t.startAttempt++;let p=await d.run(),u=c.default.get(p,"pageType"),D=performance.now()-e;!u&&D<5e3?r.backoff():a().pageTypeComplete(u,"startup")}r.on("ready",o),o()}};return d}window.Dewey||(window.Dewey=k()),l=window.Dewey;var B=l;export{w as a,S as b,B as c};
